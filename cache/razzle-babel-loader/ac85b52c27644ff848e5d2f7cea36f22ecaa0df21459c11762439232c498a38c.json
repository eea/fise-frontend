{"ast":null,"code":"import React from 'react';\nimport Undoo from 'undoo';\n\n// Code based on Apache-2.0 License\n// https://github.com/reaviz/reaflow/blob/78d60aa04f514947a17097c906efdbbd6bae5080/src/helpers/useUndo.ts\n\nconst useUndoManager = (state, onUndoRedo, {\n  maxUndoLevels,\n  enableHotKeys = true\n}) => {\n  const [canUndo, setCanUndo] = React.useState(false);\n  const [canRedo, setCanRedo] = React.useState(false);\n  const manager = React.useRef(new Undoo({\n    maxLength: maxUndoLevels\n  }));\n  // Reference:\n  // https://reactjs.org/docs/hooks-faq.html#how-to-read-an-often-changing-value-from-usecallback\n  const callbackRef = React.useRef(onUndoRedo);\n  React.useEffect(() => {\n    callbackRef.current = onUndoRedo;\n  }, [onUndoRedo]);\n  const doUndo = React.useCallback(() => {\n    manager.current.undo(({\n      state\n    }) => {\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n      callbackRef.current({\n        state,\n        type: 'undo',\n        canUndo: nextUndo,\n        canRedo: nextRedo\n      });\n    });\n  }, []);\n  React.useEffect(() => {\n    manager.current.save({\n      state\n    });\n    setCanUndo(manager.current.canUndo());\n    setCanRedo(manager.current.canRedo());\n  }, [state]);\n  const doRedo = React.useCallback(() => {\n    manager.current.redo(({\n      state\n    }) => {\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n      callbackRef.current({\n        state,\n        type: 'redo',\n        canUndo: nextUndo,\n        canRedo: nextRedo\n      });\n    });\n  }, []);\n  const handleKeys = React.useCallback(event => {\n    const keyName = event.key;\n    if (keyName === 'Control' || keyName === 'Meta') {\n      // do not alert when only Control key is pressed.\n      return;\n    }\n    if (event.ctrlKey || event.metaKey) {\n      if (keyName === 'z') {\n        event.preventDefault();\n        event.stopPropagation();\n        doUndo();\n      } else if (keyName === 'y') {\n        event.preventDefault();\n        event.stopPropagation();\n        doRedo();\n      }\n    } else {\n      return;\n    }\n  }, [doUndo, doRedo]);\n  React.useEffect(() => {\n    if (!enableHotKeys) return;\n    document.addEventListener('keydown', handleKeys);\n    return () => document.removeEventListener('keydown', handleKeys);\n  }, [enableHotKeys, handleKeys]);\n  return {\n    doUndo,\n    doRedo,\n    canUndo,\n    canRedo\n  };\n};\nexport default useUndoManager;","map":{"version":3,"names":["React","Undoo","useUndoManager","state","onUndoRedo","maxUndoLevels","enableHotKeys","canUndo","setCanUndo","useState","canRedo","setCanRedo","manager","useRef","maxLength","callbackRef","useEffect","current","doUndo","useCallback","undo","nextUndo","nextRedo","type","save","doRedo","redo","handleKeys","event","keyName","key","ctrlKey","metaKey","preventDefault","stopPropagation","document","addEventListener","removeEventListener"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@plone/volto/src/helpers/UndoManager/useUndoManager.js"],"sourcesContent":["import React from 'react';\nimport Undoo from 'undoo';\n\n// Code based on Apache-2.0 License\n// https://github.com/reaviz/reaflow/blob/78d60aa04f514947a17097c906efdbbd6bae5080/src/helpers/useUndo.ts\n\nconst useUndoManager = (\n  state,\n  onUndoRedo,\n  { maxUndoLevels, enableHotKeys = true },\n) => {\n  const [canUndo, setCanUndo] = React.useState(false);\n  const [canRedo, setCanRedo] = React.useState(false);\n  const manager = React.useRef(new Undoo({ maxLength: maxUndoLevels }));\n  // Reference:\n  // https://reactjs.org/docs/hooks-faq.html#how-to-read-an-often-changing-value-from-usecallback\n  const callbackRef = React.useRef(onUndoRedo);\n  React.useEffect(() => {\n    callbackRef.current = onUndoRedo;\n  }, [onUndoRedo]);\n\n  const doUndo = React.useCallback(() => {\n    manager.current.undo(({ state }) => {\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n\n      callbackRef.current({\n        state,\n        type: 'undo',\n        canUndo: nextUndo,\n        canRedo: nextRedo,\n      });\n    });\n  }, []);\n\n  React.useEffect(() => {\n    manager.current.save({\n      state,\n    });\n\n    setCanUndo(manager.current.canUndo());\n    setCanRedo(manager.current.canRedo());\n  }, [state]);\n\n  const doRedo = React.useCallback(() => {\n    manager.current.redo(({ state }) => {\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n\n      callbackRef.current({\n        state,\n        type: 'redo',\n        canUndo: nextUndo,\n        canRedo: nextRedo,\n      });\n    });\n  }, []);\n\n  const handleKeys = React.useCallback(\n    (event) => {\n      const keyName = event.key;\n\n      if (keyName === 'Control' || keyName === 'Meta') {\n        // do not alert when only Control key is pressed.\n        return;\n      }\n      if (event.ctrlKey || event.metaKey) {\n        if (keyName === 'z') {\n          event.preventDefault();\n          event.stopPropagation();\n          doUndo();\n        } else if (keyName === 'y') {\n          event.preventDefault();\n          event.stopPropagation();\n          doRedo();\n        }\n      } else {\n        return;\n      }\n    },\n    [doUndo, doRedo],\n  );\n\n  React.useEffect(() => {\n    if (!enableHotKeys) return;\n    document.addEventListener('keydown', handleKeys);\n    return () => document.removeEventListener('keydown', handleKeys);\n  }, [enableHotKeys, handleKeys]);\n\n  return {\n    doUndo,\n    doRedo,\n    canUndo,\n    canRedo,\n  };\n};\n\nexport default useUndoManager;\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}