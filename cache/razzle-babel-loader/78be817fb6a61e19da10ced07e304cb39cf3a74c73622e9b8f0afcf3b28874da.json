{"ast":null,"code":"import _extends from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/extends.js\";\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/node_modules/@eeacms/volto-datablocks/src/hocs/connectToProviderDataUnfiltered.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { withRouter } from 'react-router';\nimport { connect, useDispatch } from 'react-redux';\nimport { getDataFromProvider } from '../actions';\nimport { getProviderUrl, getConnectorPath } from '../helpers';\n/**\n * connectToProviderData.\n *\n * @param {} getProviderUrl\n */\nexport function connectToProviderDataUnfiltered() {\n  var _this = this;\n  var getConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {\n    return {};\n  };\n  return function (WrappedComponent) {\n    var _s = $RefreshSig$();\n    return connect(function (state) {\n      return {\n        data_providers: state.data_providers\n      };\n    })(withRouter(_s(function (props) {\n      var _props$data_providers, _props$data_providers2, _props$data_providers3, _props$data_providers4, _props$data_providers5, _props$data_providers6, _props$data_providers7, _props$data_providers8, _props$data_providers9, _props$data_providers10;\n      _s();\n      var dispatch = useDispatch();\n      var config = useMemo(function () {\n        return getConfig(props);\n      }, [props]);\n      var _useState = useState(false),\n        mounted = _useState[0],\n        setMounted = _useState[1];\n      var provider_url = useMemo(function () {\n        return getProviderUrl(config.provider_url);\n      }, [config.provider_url]);\n      var connectorPath = useMemo(function () {\n        return getConnectorPath(provider_url);\n      }, [provider_url]);\n      var provider_data = provider_url ? (_props$data_providers = props.data_providers) === null || _props$data_providers === void 0 ? void 0 : (_props$data_providers2 = _props$data_providers.data) === null || _props$data_providers2 === void 0 ? void 0 : (_props$data_providers3 = _props$data_providers2[provider_url]) === null || _props$data_providers3 === void 0 ? void 0 : _props$data_providers3._default : null;\n      var provider_metadata = provider_url ? (_props$data_providers4 = props.data_providers) === null || _props$data_providers4 === void 0 ? void 0 : (_props$data_providers5 = _props$data_providers4.metadata) === null || _props$data_providers5 === void 0 ? void 0 : (_props$data_providers6 = _props$data_providers5[provider_url]) === null || _props$data_providers6 === void 0 ? void 0 : _props$data_providers6._default : null;\n      var isPending = provider_url ? (_props$data_providers7 = props.data_providers) === null || _props$data_providers7 === void 0 ? void 0 : (_props$data_providers8 = _props$data_providers7.pendingConnectors) === null || _props$data_providers8 === void 0 ? void 0 : _props$data_providers8[connectorPath] : false;\n      var isFailed = provider_url ? (_props$data_providers9 = props.data_providers) === null || _props$data_providers9 === void 0 ? void 0 : (_props$data_providers10 = _props$data_providers9.failedConnectors) === null || _props$data_providers10 === void 0 ? void 0 : _props$data_providers10[connectorPath] : false;\n      var readyToDispatch = mounted && provider_url && !provider_data && !isPending && !isFailed;\n      useEffect(function () {\n        if (!mounted) {\n          setMounted(true);\n        }\n        if (readyToDispatch) {\n          dispatch(getDataFromProvider(provider_url));\n        }\n      }, [mounted, readyToDispatch, isPending, dispatch, provider_data, provider_url]);\n      return __jsx(WrappedComponent, _extends({}, props, {\n        provider_data: provider_data,\n        provider_metadata: provider_metadata,\n        loadingProviderData: isPending,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }\n      }));\n    }, \"7GREHg1BMGNW69h8Wzi7jKlPK8I=\", false, function () {\n      return [useDispatch];\n    })));\n  };\n}\nexport default connectToProviderDataUnfiltered;","map":{"version":3,"names":["React","useEffect","useMemo","useState","withRouter","connect","useDispatch","getDataFromProvider","getProviderUrl","getConnectorPath","connectToProviderDataUnfiltered","getConfig","WrappedComponent","state","data_providers","props","dispatch","config","mounted","setMounted","provider_url","connectorPath","provider_data","data","_default","provider_metadata","metadata","isPending","pendingConnectors","isFailed","failedConnectors","readyToDispatch"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@eeacms/volto-datablocks/src/hocs/connectToProviderDataUnfiltered.js"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\nimport { withRouter } from 'react-router';\nimport { connect, useDispatch } from 'react-redux';\nimport { getDataFromProvider } from '../actions';\nimport { getProviderUrl, getConnectorPath } from '../helpers';\n/**\n * connectToProviderData.\n *\n * @param {} getProviderUrl\n */\nexport function connectToProviderDataUnfiltered(getConfig = () => ({})) {\n  return (WrappedComponent) => {\n    return connect((state) => ({\n      data_providers: state.data_providers,\n    }))(\n      withRouter((props) => {\n        const dispatch = useDispatch();\n        const config = useMemo(() => getConfig(props), [props]);\n        const [mounted, setMounted] = useState(false);\n\n        const provider_url = useMemo(\n          () => getProviderUrl(config.provider_url),\n          [config.provider_url],\n        );\n\n        const connectorPath = useMemo(() => getConnectorPath(provider_url), [\n          provider_url,\n        ]);\n\n        const provider_data = provider_url\n          ? props.data_providers?.data?.[provider_url]?._default\n          : null;\n\n        const provider_metadata = provider_url\n          ? props.data_providers?.metadata?.[provider_url]?._default\n          : null;\n\n        const isPending = provider_url\n          ? props.data_providers?.pendingConnectors?.[connectorPath]\n          : false;\n\n        const isFailed = provider_url\n          ? props.data_providers?.failedConnectors?.[connectorPath]\n          : false;\n\n        const readyToDispatch =\n          mounted && provider_url && !provider_data && !isPending && !isFailed;\n\n        useEffect(() => {\n          if (!mounted) {\n            setMounted(true);\n          }\n\n          if (readyToDispatch) {\n            dispatch(getDataFromProvider(provider_url));\n          }\n        }, [\n          mounted,\n          readyToDispatch,\n          isPending,\n          dispatch,\n          provider_data,\n          provider_url,\n        ]);\n\n        return (\n          <WrappedComponent\n            {...props}\n            provider_data={provider_data}\n            provider_metadata={provider_metadata}\n            loadingProviderData={isPending}\n          />\n        );\n      }),\n    );\n  };\n}\n\nexport default connectToProviderDataUnfiltered;\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AAC3D,SAASC,UAAU,QAAQ,cAAc;AACzC,SAASC,OAAO,EAAEC,WAAW,QAAQ,aAAa;AAClD,SAASC,mBAAmB,QAAQ,YAAY;AAChD,SAASC,cAAc,EAAEC,gBAAgB,QAAQ,YAAY;AAC7D;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,+BAA+B,GAAyB;EAAA;EAAA,IAAxBC,SAAS,uEAAG;IAAA,OAAO,CAAC,CAAC;EAAA,CAAC;EACpE,OAAO,UAACC,gBAAgB,EAAK;IAAA;IAC3B,OAAOP,OAAO,CAAC,UAACQ,KAAK;MAAA,OAAM;QACzBC,cAAc,EAAED,KAAK,CAACC;MACxB,CAAC;IAAA,CAAC,CAAC,CACDV,UAAU,IAAC,UAACW,KAAK,EAAK;MAAA;MAAA;MACpB,IAAMC,QAAQ,GAAGV,WAAW,EAAE;MAC9B,IAAMW,MAAM,GAAGf,OAAO,CAAC;QAAA,OAAMS,SAAS,CAACI,KAAK,CAAC;MAAA,GAAE,CAACA,KAAK,CAAC,CAAC;MACvD,gBAA8BZ,QAAQ,CAAC,KAAK,CAAC;QAAtCe,OAAO;QAAEC,UAAU;MAE1B,IAAMC,YAAY,GAAGlB,OAAO,CAC1B;QAAA,OAAMM,cAAc,CAACS,MAAM,CAACG,YAAY,CAAC;MAAA,GACzC,CAACH,MAAM,CAACG,YAAY,CAAC,CACtB;MAED,IAAMC,aAAa,GAAGnB,OAAO,CAAC;QAAA,OAAMO,gBAAgB,CAACW,YAAY,CAAC;MAAA,GAAE,CAClEA,YAAY,CACb,CAAC;MAEF,IAAME,aAAa,GAAGF,YAAY,4BAC9BL,KAAK,CAACD,cAAc,oFAApB,sBAAsBS,IAAI,qFAA1B,uBAA6BH,YAAY,CAAC,2DAA1C,uBAA4CI,QAAQ,GACpD,IAAI;MAER,IAAMC,iBAAiB,GAAGL,YAAY,6BAClCL,KAAK,CAACD,cAAc,qFAApB,uBAAsBY,QAAQ,qFAA9B,uBAAiCN,YAAY,CAAC,2DAA9C,uBAAgDI,QAAQ,GACxD,IAAI;MAER,IAAMG,SAAS,GAAGP,YAAY,6BAC1BL,KAAK,CAACD,cAAc,qFAApB,uBAAsBc,iBAAiB,2DAAvC,uBAA0CP,aAAa,CAAC,GACxD,KAAK;MAET,IAAMQ,QAAQ,GAAGT,YAAY,6BACzBL,KAAK,CAACD,cAAc,sFAApB,uBAAsBgB,gBAAgB,4DAAtC,wBAAyCT,aAAa,CAAC,GACvD,KAAK;MAET,IAAMU,eAAe,GACnBb,OAAO,IAAIE,YAAY,IAAI,CAACE,aAAa,IAAI,CAACK,SAAS,IAAI,CAACE,QAAQ;MAEtE5B,SAAS,CAAC,YAAM;QACd,IAAI,CAACiB,OAAO,EAAE;UACZC,UAAU,CAAC,IAAI,CAAC;QAClB;QAEA,IAAIY,eAAe,EAAE;UACnBf,QAAQ,CAACT,mBAAmB,CAACa,YAAY,CAAC,CAAC;QAC7C;MACF,CAAC,EAAE,CACDF,OAAO,EACPa,eAAe,EACfJ,SAAS,EACTX,QAAQ,EACRM,aAAa,EACbF,YAAY,CACb,CAAC;MAEF,OACE,MAAC,gBAAgB,eACXL,KAAK;QACT,aAAa,EAAEO,aAAc;QAC7B,iBAAiB,EAAEG,iBAAkB;QACrC,mBAAmB,EAAEE,SAAU;QAAA;QAAA;UAAA;UAAA;UAAA;QAAA;MAAA,GAC/B;IAEN,CAAC;MAAA,QAzDkBrB,WAAW;IAAA,GAyD5B,CACH;EACH,CAAC;AACH;AAEA,eAAeI,+BAA+B"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}