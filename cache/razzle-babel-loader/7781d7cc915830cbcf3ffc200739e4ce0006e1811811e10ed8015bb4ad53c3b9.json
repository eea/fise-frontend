{"ast":null,"code":"import _omit from \"lodash/omit\";\nimport _isEqual from \"lodash/isEqual\";\nimport _isEmpty from \"lodash/isEmpty\";\nconst _excluded = [\"element\", \"attributes\", \"extras\"],\n  _excluded2 = [\"children\"];\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/src/develop/volto-slate/src/editor/render.jsx\";\nvar __jsx = React.createElement;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\nimport React from 'react';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport { Node, Text } from 'slate';\nimport cx from 'classnames';\nimport config from '@plone/volto/registry';\nconst OMITTED = ['editor', 'path'];\n\n// TODO: read, see if relevant\n// https://reactjs.org/docs/higher-order-components.html#dont-use-hocs-inside-the-render-method\nexport const Element = _ref => {\n  let {\n      element,\n      attributes = {},\n      extras\n    } = _ref,\n    rest = _objectWithoutProperties(_ref, _excluded);\n  const {\n    slate\n  } = config.settings;\n  const {\n    elements\n  } = slate;\n  const El = elements[element.type] || elements['default'];\n  const out = Object.assign(...Object.keys(attributes || {}).map(k => !_isEmpty(attributes[k]) ? {\n    [k]: attributes[k]\n  } : {}), element.styleName ? {\n    className: cx(attributes.className, element.styleName)\n  } : {});\n  return __jsx(El, _extends({\n    element: element\n  }, _omit(rest, OMITTED), {\n    attributes: out,\n    extras: extras,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 27,\n      columnNumber: 5\n    }\n  }));\n};\nexport const Leaf = _ref2 => {\n  let {\n      children\n    } = _ref2,\n    rest = _objectWithoutProperties(_ref2, _excluded2);\n  // console.log('rest', rest, children);\n  const {\n    attributes,\n    leaf,\n    mode\n  } = rest;\n  let {\n    leafs\n  } = config.settings.slate;\n  children = Object.keys(leafs).reduce((acc, name) => {\n    return Object.keys(leaf).includes(name) ? leafs[name]({\n      children: acc\n    }) : acc;\n  }, children);\n  const classNames = {\n    [`highlight-${leaf.highlightType}`]: mode !== 'view' && leaf.highlight,\n    'highlight-selection': mode !== 'view' && leaf.isSelection\n  };\n\n  // stylemenu support\n  for (const prop in leaf) {\n    if (prop.startsWith('style-')) {\n      classNames[prop.substring(6)] = true;\n    }\n  }\n  const klass = cx(classNames);\n  return mode === 'view' ? typeof children === 'string' ? children.split('\\n').map((t, i) => {\n    // Softbreak support. Should do a plugin?\n    return __jsx(React.Fragment, {\n      key: `${i}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 11\n      }\n    }, children.indexOf('\\n') > -1 && children.split('\\n').length - 1 > i ? __jsx(React.Fragment, null, klass ? __jsx(\"span\", {\n      className: klass,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 26\n      }\n    }, t) : t, __jsx(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 17\n      }\n    })) : klass ? __jsx(\"span\", {\n      className: klass,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 15\n      }\n    }, t) : t);\n  }) : __jsx(\"span\", {\n    className: klass,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }\n  }, children) : __jsx(\"span\", _extends({}, attributes, {\n    className: klass,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 5\n    }\n  }), children);\n};\nconst serializeData = node => {\n  return JSON.stringify({\n    type: node.type,\n    data: node.data\n  });\n};\nexport const serializeNodes = (nodes, getAttributes, extras = {}) => {\n  const editor = {\n    children: nodes || []\n  };\n  const _serializeNodes = nodes => {\n    return (nodes || []).map(([node, path], i) => {\n      return Text.isText(node) ? __jsx(Leaf, {\n        path: path,\n        leaf: node,\n        text: node,\n        mode: \"view\",\n        key: path,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 9\n        }\n      }, node.text) : __jsx(Element, {\n        path: path,\n        element: node,\n        mode: \"view\",\n        key: path,\n        \"data-slate-data\": node.data ? serializeData(node) : null,\n        attributes: _isEqual(path, [0]) ? getAttributes ? getAttributes(node, path) : null : null,\n        extras: extras,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 9\n        }\n      }, _serializeNodes(Array.from(Node.children(editor, path))));\n    });\n  };\n  return _serializeNodes(Array.from(Node.children(editor, [])));\n};\n\n/**\n * Get the concatenated text string of a node's content.\n *\n * Note that this WILL include spaces between block node leafs in contrary to\n * the original slate method. This function joins text of nodes with\n * separating spaces to produce a string for indexing purposes.\n *\n */\nconst ConcatenatedString = node => {\n  if (Text.isText(node)) {\n    return node.text.trim();\n  } else {\n    return node.children.map(ConcatenatedString).join(' ');\n  }\n};\n\n/**\n * @function serializeNodesToText\n *\n * @param {Array[Node]} nodes\n *\n * @returns {string}\n */\nexport const serializeNodesToText = nodes => {\n  return nodes.map(ConcatenatedString).join('\\n');\n};\nexport const serializeNodesToHtml = nodes => renderToStaticMarkup(serializeNodes(nodes));","map":{"version":3,"names":["React","renderToStaticMarkup","Node","Text","cx","config","OMITTED","Element","element","attributes","extras","rest","slate","settings","elements","El","type","out","Object","assign","keys","map","k","styleName","className","Leaf","children","leaf","mode","leafs","reduce","acc","name","includes","classNames","highlightType","highlight","isSelection","prop","startsWith","substring","klass","split","t","i","indexOf","length","serializeData","node","JSON","stringify","data","serializeNodes","nodes","getAttributes","editor","_serializeNodes","path","isText","text","Array","from","ConcatenatedString","trim","join","serializeNodesToText","serializeNodesToHtml"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-slate/src/editor/render.jsx"],"sourcesContent":["import React from 'react';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport { Node, Text } from 'slate';\nimport cx from 'classnames';\nimport { isEmpty, isEqual, omit } from 'lodash';\nimport config from '@plone/volto/registry';\n\nconst OMITTED = ['editor', 'path'];\n\n// TODO: read, see if relevant\n// https://reactjs.org/docs/higher-order-components.html#dont-use-hocs-inside-the-render-method\nexport const Element = ({ element, attributes = {}, extras, ...rest }) => {\n  const { slate } = config.settings;\n  const { elements } = slate;\n  const El = elements[element.type] || elements['default'];\n\n  const out = Object.assign(\n    ...Object.keys(attributes || {}).map((k) =>\n      !isEmpty(attributes[k]) ? { [k]: attributes[k] } : {},\n    ),\n    element.styleName\n      ? { className: cx(attributes.className, element.styleName) }\n      : {},\n  );\n\n  return (\n    <El\n      element={element}\n      {...omit(rest, OMITTED)}\n      attributes={out}\n      extras={extras}\n    />\n  );\n};\n\nexport const Leaf = ({ children, ...rest }) => {\n  // console.log('rest', rest, children);\n  const { attributes, leaf, mode } = rest;\n  let { leafs } = config.settings.slate;\n\n  children = Object.keys(leafs).reduce((acc, name) => {\n    return Object.keys(leaf).includes(name)\n      ? leafs[name]({ children: acc })\n      : acc;\n  }, children);\n\n  const classNames = {\n    [`highlight-${leaf.highlightType}`]: mode !== 'view' && leaf.highlight,\n    'highlight-selection': mode !== 'view' && leaf.isSelection,\n  };\n\n  // stylemenu support\n  for (const prop in leaf) {\n    if (prop.startsWith('style-')) {\n      classNames[prop.substring(6)] = true;\n    }\n  }\n\n  const klass = cx(classNames);\n\n  return mode === 'view' ? (\n    typeof children === 'string' ? (\n      children.split('\\n').map((t, i) => {\n        // Softbreak support. Should do a plugin?\n        return (\n          <React.Fragment key={`${i}`}>\n            {children.indexOf('\\n') > -1 &&\n            children.split('\\n').length - 1 > i ? (\n              <>\n                {klass ? <span className={klass}>{t}</span> : t}\n                <br />\n              </>\n            ) : klass ? (\n              <span className={klass}>{t}</span>\n            ) : (\n              t\n            )}\n          </React.Fragment>\n        );\n      })\n    ) : (\n      <span className={klass}>{children}</span>\n    )\n  ) : (\n    <span {...attributes} className={klass}>\n      {children}\n    </span>\n  );\n};\n\nconst serializeData = (node) => {\n  return JSON.stringify({ type: node.type, data: node.data });\n};\n\nexport const serializeNodes = (nodes, getAttributes, extras = {}) => {\n  const editor = { children: nodes || [] };\n\n  const _serializeNodes = (nodes) => {\n    return (nodes || []).map(([node, path], i) => {\n      return Text.isText(node) ? (\n        <Leaf path={path} leaf={node} text={node} mode=\"view\" key={path}>\n          {node.text}\n        </Leaf>\n      ) : (\n        <Element\n          path={path}\n          element={node}\n          mode=\"view\"\n          key={path}\n          data-slate-data={node.data ? serializeData(node) : null}\n          attributes={\n            isEqual(path, [0])\n              ? getAttributes\n                ? getAttributes(node, path)\n                : null\n              : null\n          }\n          extras={extras}\n        >\n          {_serializeNodes(Array.from(Node.children(editor, path)))}\n        </Element>\n      );\n    });\n  };\n\n  return _serializeNodes(Array.from(Node.children(editor, [])));\n};\n\n/**\n * Get the concatenated text string of a node's content.\n *\n * Note that this WILL include spaces between block node leafs in contrary to\n * the original slate method. This function joins text of nodes with\n * separating spaces to produce a string for indexing purposes.\n *\n */\nconst ConcatenatedString = (node) => {\n  if (Text.isText(node)) {\n    return node.text.trim();\n  } else {\n    return node.children.map(ConcatenatedString).join(' ');\n  }\n};\n\n/**\n * @function serializeNodesToText\n *\n * @param {Array[Node]} nodes\n *\n * @returns {string}\n */\nexport const serializeNodesToText = (nodes) => {\n  return nodes.map(ConcatenatedString).join('\\n');\n};\n\nexport const serializeNodesToHtml = (nodes) =>\n  renderToStaticMarkup(serializeNodes(nodes));\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}