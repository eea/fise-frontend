{"ast":null,"code":"import _extends from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/extends.js\";\nimport _objectSpread from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _slicedToArray from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/src/develop/volto-eea-map/src/components/Blocks/EmbedEEAMap/View.jsx\",\n  _this = this,\n  _s = $RefreshSig$();\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { PrivacyProtection } from '@eeacms/volto-embed';\nimport { getContent } from '@plone/volto/actions';\nimport Webmap from '../../Webmap';\nimport ExtraViews from '../../ExtraViews';\nvar View = function View(props) {\n  _s();\n  var _ref = props || {},\n    data = _ref.data,\n    id = _ref.id,\n    isEdit = _ref.isEdit,\n    _ref$map_visualizatio = _ref.map_visualization,\n    map_visualization = _ref$map_visualizatio === void 0 ? '' : _ref$map_visualizatio,\n    _ref$data_provenance = _ref.data_provenance,\n    data_provenance = _ref$data_provenance === void 0 ? {} : _ref$data_provenance;\n  var _data$height = data.height,\n    height = _data$height === void 0 ? '' : _data$height,\n    _data$vis_url = data.vis_url,\n    vis_url = _data$vis_url === void 0 ? '' : _data$vis_url,\n    enable_queries = data.enable_queries;\n  var _React$useState = React.useState(map_visualization),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    mapData = _React$useState2[0],\n    setMapData = _React$useState2[1];\n  React.useEffect(function () {\n    if (vis_url) {\n      props.getContent(vis_url, null, id);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [vis_url, enable_queries]);\n  React.useEffect(function () {\n    var _props$data;\n    var altMapData = _objectSpread({}, map_visualization);\n    var query_params = isEdit ? (_props$data = props.data) === null || _props$data === void 0 ? void 0 : _props$data.data_query_params : props === null || props === void 0 ? void 0 : props.data_query;\n    if (enable_queries && map_visualization && query_params && query_params.length > 0 && altMapData.layers && altMapData.layers.map_layers && altMapData.layers.map_layers.length > 0) {\n      var rules = [];\n      altMapData.layers.map_layers.forEach(function (l, j) {\n        query_params.forEach(function (param, i) {\n          var matchingFields = l.map_layer && l.map_layer.fields && l.map_layer.fields.length > 0 ? l.map_layer.fields.filter(function (field, k) {\n            return field.name === param.alias || field.name === param.i;\n          }) : [];\n          matchingFields.forEach(function (m, i) {\n            var newRules = param.v ? param.v.map(function (paramVal, i) {\n              return {\n                field: m.name,\n                operator: '=',\n                value: paramVal\n              };\n            }) : [];\n            rules = rules.concat(newRules);\n          });\n        });\n        var autoQuery = {\n          combinator: 'or',\n          rules: rules\n        };\n        altMapData.layers.map_layers[j].map_layer.query = autoQuery;\n      });\n    }\n    setMapData(altMapData);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [map_visualization, props.data, props.data_query, isEdit, enable_queries]);\n  return __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 5\n    }\n  }, __jsx(PrivacyProtection, _extends({\n    data: data,\n    height: height\n  }, props, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }\n  }), mapData && __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 11\n    }\n  }, __jsx(Webmap, {\n    data: mapData,\n    height: height,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 13\n    }\n  }), __jsx(ExtraViews, {\n    data: _objectSpread(_objectSpread({}, data), {}, {\n      data_provenance: data_provenance,\n      map_data: map_visualization\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }\n  })), !mapData && __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 11\n    }\n  }, \"No map view to show. Set visualization in block configuration.\")));\n};\n_s(View, \"1chmeQtMst7Ibfl+CbHg5SqV6dQ=\");\n_c = View;\nexport default compose(connect(function (state, props) {\n  var _state$content$subreq, _state$content$subreq2, _state$content$subreq3, _state$content$subreq4, _state$content$subreq5, _state$content$subreq6;\n  return {\n    data_query: state.content.data.data_query,\n    data_provenance: (_state$content$subreq = state.content.subrequests) === null || _state$content$subreq === void 0 ? void 0 : (_state$content$subreq2 = _state$content$subreq[props.id]) === null || _state$content$subreq2 === void 0 ? void 0 : (_state$content$subreq3 = _state$content$subreq2.data) === null || _state$content$subreq3 === void 0 ? void 0 : _state$content$subreq3.data_provenance,\n    map_visualization: (_state$content$subreq4 = state.content.subrequests) === null || _state$content$subreq4 === void 0 ? void 0 : (_state$content$subreq5 = _state$content$subreq4[props.id]) === null || _state$content$subreq5 === void 0 ? void 0 : (_state$content$subreq6 = _state$content$subreq5.data) === null || _state$content$subreq6 === void 0 ? void 0 : _state$content$subreq6.map_visualization_data\n  };\n}, {\n  getContent: getContent\n}))(View);\nvar _c;\n$RefreshReg$(_c, \"View\");","map":{"version":3,"names":["React","connect","compose","PrivacyProtection","getContent","Webmap","ExtraViews","View","props","data","id","isEdit","map_visualization","data_provenance","height","vis_url","enable_queries","useState","mapData","setMapData","useEffect","altMapData","query_params","data_query_params","data_query","length","layers","map_layers","rules","forEach","l","j","param","i","matchingFields","map_layer","fields","filter","field","k","name","alias","m","newRules","v","map","paramVal","operator","value","concat","autoQuery","combinator","query","map_data","state","content","subrequests","map_visualization_data"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-eea-map/src/components/Blocks/EmbedEEAMap/View.jsx"],"sourcesContent":["import React from 'react';\n\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\n\nimport { PrivacyProtection } from '@eeacms/volto-embed';\n\nimport { getContent } from '@plone/volto/actions';\nimport Webmap from '../../Webmap';\nimport ExtraViews from '../../ExtraViews';\n\nconst View = (props) => {\n  const { data, id, isEdit, map_visualization = '', data_provenance = {} } =\n    props || {};\n  const { height = '', vis_url = '', enable_queries } = data;\n\n  const [mapData, setMapData] = React.useState(map_visualization);\n\n  React.useEffect(() => {\n    if (vis_url) {\n      props.getContent(vis_url, null, id);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [vis_url, enable_queries]);\n\n  React.useEffect(() => {\n    var altMapData = { ...map_visualization };\n    const query_params = isEdit\n      ? props.data?.data_query_params\n      : props?.data_query;\n    if (\n      enable_queries &&\n      map_visualization &&\n      query_params &&\n      query_params.length > 0 &&\n      altMapData.layers &&\n      altMapData.layers.map_layers &&\n      altMapData.layers.map_layers.length > 0\n    ) {\n      let rules = [];\n\n      altMapData.layers.map_layers.forEach((l, j) => {\n        query_params.forEach((param, i) => {\n          const matchingFields =\n            l.map_layer && l.map_layer.fields && l.map_layer.fields.length > 0\n              ? l.map_layer.fields.filter(\n                  (field, k) =>\n                    field.name === param.alias || field.name === param.i,\n                )\n              : [];\n\n          matchingFields.forEach((m, i) => {\n            const newRules = param.v\n              ? param.v.map((paramVal, i) => {\n                  return {\n                    field: m.name,\n                    operator: '=',\n                    value: paramVal,\n                  };\n                })\n              : [];\n            rules = rules.concat(newRules);\n          });\n        });\n        let autoQuery = {\n          combinator: 'or',\n          rules,\n        };\n        altMapData.layers.map_layers[j].map_layer.query = autoQuery;\n      });\n    }\n    setMapData(altMapData);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [map_visualization, props.data, props.data_query, isEdit, enable_queries]);\n\n  return (\n    <div>\n      <PrivacyProtection data={data} height={height} {...props}>\n        {mapData && (\n          <div>\n            <Webmap data={mapData} height={height} />\n            <ExtraViews\n              data={{\n                ...data,\n                data_provenance,\n                map_data: map_visualization,\n              }}\n            />\n          </div>\n        )}\n        {!mapData && (\n          <p>No map view to show. Set visualization in block configuration.</p>\n        )}\n      </PrivacyProtection>\n    </div>\n  );\n};\n\nexport default compose(\n  connect(\n    (state, props) => ({\n      data_query: state.content.data.data_query,\n      data_provenance:\n        state.content.subrequests?.[props.id]?.data?.data_provenance,\n      map_visualization:\n        state.content.subrequests?.[props.id]?.data?.map_visualization_data,\n    }),\n    {\n      getContent,\n    },\n  ),\n)(View);\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}