{"ast":null,"code":"import _slicedToArray from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _isEmpty from \"lodash/isEmpty\";\nimport _filter from \"lodash/filter\";\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/src/develop/volto-slate/src/blocks/Text/SlashMenu.jsx\",\n  _s = $RefreshSig$(),\n  _this = this,\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\nvar __jsx = React.createElement;\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Menu } from 'semantic-ui-react';\nimport { useIntl, FormattedMessage } from 'react-intl';\nimport { Icon } from '@plone/volto/components';\nvar emptySlateBlock = function emptySlateBlock() {\n  return {\n    value: [{\n      children: [{\n        text: ''\n      }],\n      type: 'p'\n    }],\n    plaintext: ''\n  };\n};\nvar useIsMounted = function useIsMounted() {\n  _s();\n  var ref = React.useRef();\n  React.useEffect(function () {\n    ref.current = true;\n    return function () {\n      return ref.current = false;\n    };\n  }, []);\n  return ref.current;\n};\n_s(useIsMounted, \"8uVE59eA/r6b92xF80p7sH8rXLk=\");\nvar SlashMenu = function SlashMenu(_ref) {\n  _s2();\n  var currentBlock = _ref.currentBlock,\n    onMutateBlock = _ref.onMutateBlock,\n    selected = _ref.selected,\n    availableBlocks = _ref.availableBlocks;\n  var intl = useIntl();\n  return __jsx(\"div\", {\n    className: \"power-user-menu\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 5\n    }\n  }, __jsx(Menu, {\n    vertical: true,\n    fluid: true,\n    borderless: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 7\n    }\n  }, availableBlocks.map(function (block, index) {\n    return __jsx(Menu.Item, {\n      key: block.id,\n      className: block.id,\n      active: index === selected,\n      onClick: function onClick(e) {\n        // onInsertBlock(currentBlock, { '@type': block.id });\n        onMutateBlock(currentBlock, {\n          '@type': block.id\n        });\n        e.stopPropagation();\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 43,\n        columnNumber: 11\n      }\n    }, __jsx(Icon, {\n      name: block.icon,\n      size: \"24px\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 13\n      }\n    }), intl.formatMessage({\n      id: block.title,\n      defaultMessage: block.title\n    }));\n  }), availableBlocks.length === 0 && __jsx(Menu.Item, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 11\n    }\n  }, __jsx(FormattedMessage, {\n    id: \"No matching blocks\",\n    defaultMessage: \"No matching blocks\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 13\n    }\n  }))));\n};\n_s2(SlashMenu, \"rlSgSjbewJ1PrR/Ile8g/kr050o=\", false, function () {\n  return [useIntl];\n});\n_c = SlashMenu;\nSlashMenu.propTypes = {\n  currentBlock: PropTypes.string.isRequired,\n  onInsertBlock: PropTypes.func,\n  selected: PropTypes.number,\n  blocksConfig: PropTypes.arrayOf(PropTypes.any)\n};\n\n/**\n * A SlashMenu wrapper implemented as a volto-slate PersistentHelper.\n */\nvar PersistentSlashMenu = function PersistentSlashMenu(_ref2) {\n  _s3();\n  var _data$plaintext;\n  var editor = _ref2.editor;\n  var props = editor.getBlockProps();\n  var block = props.block,\n    blocksConfig = props.blocksConfig,\n    data = props.data,\n    onMutateBlock = props.onMutateBlock,\n    properties = props.properties,\n    selected = props.selected,\n    allowedBlocks = props.allowedBlocks,\n    detached = props.detached;\n  var disableNewBlocks = (data === null || data === void 0 ? void 0 : data.disableNewBlocks) || detached;\n  var _React$useState = React.useState(0),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    slashMenuSelected = _React$useState2[0],\n    setSlashMenuSelected = _React$useState2[1];\n  var useAllowedBlocks = !_isEmpty(allowedBlocks);\n  var slashCommand = (_data$plaintext = data.plaintext) === null || _data$plaintext === void 0 ? void 0 : _data$plaintext.trim().match(/^\\/([a-z]*)$/);\n  var availableBlocks = React.useMemo(function () {\n    return _filter(blocksConfig, function (item) {\n      return useAllowedBlocks ? allowedBlocks.includes(item.id) : typeof item.restricted === 'function' ? !item.restricted({\n        properties: properties,\n        block: item\n      }) : !item.restricted;\n    }).filter(\n    // TODO: make it work with intl?\n    function (block) {\n      return slashCommand && block.id.indexOf(slashCommand[1]) === 0;\n    }).sort(function (a, b) {\n      return a.title < b.title ? -1 : 1;\n    });\n  }, [allowedBlocks, blocksConfig, properties, slashCommand, useAllowedBlocks]);\n  var slashMenuSize = availableBlocks.length;\n  var show = selected && slashCommand && !disableNewBlocks;\n  var isMounted = useIsMounted();\n  React.useEffect(function () {\n    if (isMounted && show && slashMenuSelected > slashMenuSize - 1) {\n      setSlashMenuSelected(slashMenuSize - 1);\n    }\n  }, [show, slashMenuSelected, isMounted, slashMenuSize]);\n  editor.showSlashMenu = show;\n  editor.slashEnter = function () {\n    return slashMenuSize > 0 && onMutateBlock(block, {\n      '@type': availableBlocks[slashMenuSelected].id\n    }, emptySlateBlock());\n  };\n  editor.slashArrowUp = function () {\n    return setSlashMenuSelected(slashMenuSelected === 0 ? slashMenuSize - 1 : slashMenuSelected - 1);\n  };\n  editor.slashArrowDown = function () {\n    return setSlashMenuSelected(slashMenuSelected >= slashMenuSize - 1 ? 0 : slashMenuSelected + 1);\n  };\n  return show ? __jsx(SlashMenu, {\n    currentBlock: block,\n    onMutateBlock: onMutateBlock,\n    availableBlocks: availableBlocks,\n    selected: slashMenuSelected,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 5\n    }\n  }) : '';\n};\n_s3(PersistentSlashMenu, \"5lo5otTDMwpHYkyeK3ffnnEijvs=\", false, function () {\n  return [useIsMounted];\n});\n_c2 = PersistentSlashMenu;\nexport default PersistentSlashMenu;\nvar _c, _c2;\n$RefreshReg$(_c, \"SlashMenu\");\n$RefreshReg$(_c2, \"PersistentSlashMenu\");","map":{"version":3,"names":["React","PropTypes","Menu","useIntl","FormattedMessage","Icon","emptySlateBlock","value","children","text","type","plaintext","useIsMounted","ref","useRef","useEffect","current","SlashMenu","currentBlock","onMutateBlock","selected","availableBlocks","intl","map","block","index","id","e","stopPropagation","icon","formatMessage","title","defaultMessage","length","propTypes","string","isRequired","onInsertBlock","func","number","blocksConfig","arrayOf","any","PersistentSlashMenu","editor","props","getBlockProps","data","properties","allowedBlocks","detached","disableNewBlocks","useState","slashMenuSelected","setSlashMenuSelected","useAllowedBlocks","slashCommand","trim","match","useMemo","item","includes","restricted","filter","indexOf","sort","a","b","slashMenuSize","show","isMounted","showSlashMenu","slashEnter","slashArrowUp","slashArrowDown"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-slate/src/blocks/Text/SlashMenu.jsx"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { filter, isEmpty } from 'lodash';\nimport { Menu } from 'semantic-ui-react';\nimport { useIntl, FormattedMessage } from 'react-intl';\nimport { Icon } from '@plone/volto/components';\n\nconst emptySlateBlock = () => ({\n  value: [\n    {\n      children: [\n        {\n          text: '',\n        },\n      ],\n      type: 'p',\n    },\n  ],\n  plaintext: '',\n});\n\nconst useIsMounted = () => {\n  const ref = React.useRef();\n  React.useEffect(() => {\n    ref.current = true;\n    return () => (ref.current = false);\n  }, []);\n  return ref.current;\n};\n\nconst SlashMenu = ({\n  currentBlock,\n  onMutateBlock,\n  selected,\n  availableBlocks,\n}) => {\n  const intl = useIntl();\n\n  return (\n    <div className=\"power-user-menu\">\n      <Menu vertical fluid borderless>\n        {availableBlocks.map((block, index) => (\n          <Menu.Item\n            key={block.id}\n            className={block.id}\n            active={index === selected}\n            onClick={(e) => {\n              // onInsertBlock(currentBlock, { '@type': block.id });\n              onMutateBlock(currentBlock, { '@type': block.id });\n              e.stopPropagation();\n            }}\n          >\n            <Icon name={block.icon} size=\"24px\" />\n            {intl.formatMessage({\n              id: block.title,\n              defaultMessage: block.title,\n            })}\n          </Menu.Item>\n        ))}\n        {availableBlocks.length === 0 && (\n          <Menu.Item>\n            <FormattedMessage\n              id=\"No matching blocks\"\n              defaultMessage=\"No matching blocks\"\n            />\n          </Menu.Item>\n        )}\n      </Menu>\n    </div>\n  );\n};\n\nSlashMenu.propTypes = {\n  currentBlock: PropTypes.string.isRequired,\n  onInsertBlock: PropTypes.func,\n  selected: PropTypes.number,\n  blocksConfig: PropTypes.arrayOf(PropTypes.any),\n};\n\n/**\n * A SlashMenu wrapper implemented as a volto-slate PersistentHelper.\n */\nconst PersistentSlashMenu = ({ editor }) => {\n  const props = editor.getBlockProps();\n  const {\n    block,\n    blocksConfig,\n    data,\n    onMutateBlock,\n    properties,\n    selected,\n    allowedBlocks,\n    detached,\n  } = props;\n  const disableNewBlocks = data?.disableNewBlocks || detached;\n\n  const [slashMenuSelected, setSlashMenuSelected] = React.useState(0);\n\n  const useAllowedBlocks = !isEmpty(allowedBlocks);\n  const slashCommand = data.plaintext?.trim().match(/^\\/([a-z]*)$/);\n\n  const availableBlocks = React.useMemo(\n    () =>\n      filter(blocksConfig, (item) =>\n        useAllowedBlocks\n          ? allowedBlocks.includes(item.id)\n          : typeof item.restricted === 'function'\n          ? !item.restricted({ properties, block: item })\n          : !item.restricted,\n      )\n        .filter(\n          // TODO: make it work with intl?\n          (block) => slashCommand && block.id.indexOf(slashCommand[1]) === 0,\n        )\n        .sort((a, b) => (a.title < b.title ? -1 : 1)),\n    [allowedBlocks, blocksConfig, properties, slashCommand, useAllowedBlocks],\n  );\n\n  const slashMenuSize = availableBlocks.length;\n  const show = selected && slashCommand && !disableNewBlocks;\n\n  const isMounted = useIsMounted();\n\n  React.useEffect(() => {\n    if (isMounted && show && slashMenuSelected > slashMenuSize - 1) {\n      setSlashMenuSelected(slashMenuSize - 1);\n    }\n  }, [show, slashMenuSelected, isMounted, slashMenuSize]);\n\n  editor.showSlashMenu = show;\n\n  editor.slashEnter = () =>\n    slashMenuSize > 0 &&\n    onMutateBlock(\n      block,\n      {\n        '@type': availableBlocks[slashMenuSelected].id,\n      },\n      emptySlateBlock(),\n    );\n\n  editor.slashArrowUp = () =>\n    setSlashMenuSelected(\n      slashMenuSelected === 0 ? slashMenuSize - 1 : slashMenuSelected - 1,\n    );\n\n  editor.slashArrowDown = () =>\n    setSlashMenuSelected(\n      slashMenuSelected >= slashMenuSize - 1 ? 0 : slashMenuSelected + 1,\n    );\n\n  return show ? (\n    <SlashMenu\n      currentBlock={block}\n      onMutateBlock={onMutateBlock}\n      availableBlocks={availableBlocks}\n      selected={slashMenuSelected}\n    />\n  ) : (\n    ''\n  );\n};\n\nexport default PersistentSlashMenu;\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[{"id":"No matching blocks","defaultMessage":"No matching blocks"}]}},"sourceType":"module","externalDependencies":[]}