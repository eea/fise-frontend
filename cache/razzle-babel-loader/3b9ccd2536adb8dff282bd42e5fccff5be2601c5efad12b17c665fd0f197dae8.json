{"ast":null,"code":"import _extends from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/extends.js\";\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/node_modules/@eeacms/volto-plotlycharts/src/hocs/connectBlockToVisualization.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useMemo } from 'react';\nimport { withRouter } from 'react-router';\nimport { connect, useDispatch } from 'react-redux';\nimport { getVisualization, removeVisualization } from '@eeacms/volto-plotlycharts/actions';\n\n/**\n * connectBlockToVisualization.\n *\n * @param {} WrappedComponent\n */\nfunction connectBlockToVisualization() {\n  var _this = this;\n  var getConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {\n    return {};\n  };\n  return function (WrappedComponent) {\n    var _s = $RefreshSig$();\n    return connect(function (state) {\n      return {\n        data_visualizations: state.data_visualizations\n      };\n    })(withRouter(_s(function (props) {\n      var _props$data_visualiza, _props$data_visualiza2, _props$data_visualiza3, _props$data_visualiza4, _props$data_visualiza5, _props$data_visualiza6;\n      _s();\n      var dispatch = useDispatch();\n      var config = useMemo(function () {\n        return getConfig(props);\n      }, [props]);\n      var vis_url = useMemo(function () {\n        return config.vis_url;\n      }, [config.vis_url]);\n      var use_live_data = useMemo(function () {\n        var _config$use_live_data;\n        return (_config$use_live_data = config.use_live_data) !== null && _config$use_live_data !== void 0 ? _config$use_live_data : true;\n      }, [config.use_live_data]);\n      var isPending = vis_url ? (_props$data_visualiza = props.data_visualizations) === null || _props$data_visualiza === void 0 ? void 0 : (_props$data_visualiza2 = _props$data_visualiza.pendingVisualizations) === null || _props$data_visualiza2 === void 0 ? void 0 : _props$data_visualiza2[vis_url] : false;\n      var isFailed = vis_url ? (_props$data_visualiza3 = props.data_visualizations) === null || _props$data_visualiza3 === void 0 ? void 0 : (_props$data_visualiza4 = _props$data_visualiza3.failedVisualizations) === null || _props$data_visualiza4 === void 0 ? void 0 : _props$data_visualiza4[vis_url] : false;\n      var visualization_data = vis_url ? (_props$data_visualiza5 = props.data_visualizations) === null || _props$data_visualiza5 === void 0 ? void 0 : (_props$data_visualiza6 = _props$data_visualiza5.data) === null || _props$data_visualiza6 === void 0 ? void 0 : _props$data_visualiza6[vis_url] : null;\n      var readyToDispatch = vis_url && !visualization_data && !isPending && !isFailed;\n      useEffect(function () {\n        if (visualization_data) {\n          dispatch(removeVisualization(vis_url));\n        }\n        /* eslint-disable-next-line */\n      }, [use_live_data]);\n      useEffect(function () {\n        if (readyToDispatch) {\n          dispatch(getVisualization(vis_url, use_live_data));\n        }\n      });\n      return __jsx(WrappedComponent, _extends({}, props, {\n        visualization_data: visualization_data,\n        loadingVisualizationData: isPending,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 57,\n          columnNumber: 11\n        }\n      }));\n    }, \"ANRR69LX/S8EjSqsRG6oZO/ylys=\", false, function () {\n      return [useDispatch];\n    })));\n  };\n}\nexport default connectBlockToVisualization;","map":{"version":3,"names":["React","useEffect","useMemo","withRouter","connect","useDispatch","getVisualization","removeVisualization","connectBlockToVisualization","getConfig","WrappedComponent","state","data_visualizations","props","dispatch","config","vis_url","use_live_data","isPending","pendingVisualizations","isFailed","failedVisualizations","visualization_data","data","readyToDispatch"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@eeacms/volto-plotlycharts/src/hocs/connectBlockToVisualization.js"],"sourcesContent":["import React, { useEffect, useMemo } from 'react';\nimport { withRouter } from 'react-router';\nimport { connect, useDispatch } from 'react-redux';\nimport {\n  getVisualization,\n  removeVisualization,\n} from '@eeacms/volto-plotlycharts/actions';\n\n/**\n * connectBlockToVisualization.\n *\n * @param {} WrappedComponent\n */\nfunction connectBlockToVisualization(getConfig = () => ({})) {\n  return (WrappedComponent) => {\n    return connect((state) => ({\n      data_visualizations: state.data_visualizations,\n    }))(\n      withRouter((props) => {\n        const dispatch = useDispatch();\n        const config = useMemo(() => getConfig(props), [props]);\n\n        const vis_url = useMemo(() => config.vis_url, [config.vis_url]);\n        const use_live_data = useMemo(() => config.use_live_data ?? true, [\n          config.use_live_data,\n        ]);\n\n        const isPending = vis_url\n          ? props.data_visualizations?.pendingVisualizations?.[vis_url]\n          : false;\n\n        const isFailed = vis_url\n          ? props.data_visualizations?.failedVisualizations?.[vis_url]\n          : false;\n\n        const visualization_data = vis_url\n          ? props.data_visualizations?.data?.[vis_url]\n          : null;\n\n        const readyToDispatch =\n          vis_url && !visualization_data && !isPending && !isFailed;\n\n        useEffect(() => {\n          if (visualization_data) {\n            dispatch(removeVisualization(vis_url));\n          }\n          /* eslint-disable-next-line */\n        }, [use_live_data]);\n\n        useEffect(() => {\n          if (readyToDispatch) {\n            dispatch(getVisualization(vis_url, use_live_data));\n          }\n        });\n\n        return (\n          <WrappedComponent\n            {...props}\n            visualization_data={visualization_data}\n            loadingVisualizationData={isPending}\n          />\n        );\n      }),\n    );\n  };\n}\n\nexport default connectBlockToVisualization;\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,OAAO,QAAQ,OAAO;AACjD,SAASC,UAAU,QAAQ,cAAc;AACzC,SAASC,OAAO,EAAEC,WAAW,QAAQ,aAAa;AAClD,SACEC,gBAAgB,EAChBC,mBAAmB,QACd,oCAAoC;;AAE3C;AACA;AACA;AACA;AACA;AACA,SAASC,2BAA2B,GAAyB;EAAA;EAAA,IAAxBC,SAAS,uEAAG;IAAA,OAAO,CAAC,CAAC;EAAA,CAAC;EACzD,OAAO,UAACC,gBAAgB,EAAK;IAAA;IAC3B,OAAON,OAAO,CAAC,UAACO,KAAK;MAAA,OAAM;QACzBC,mBAAmB,EAAED,KAAK,CAACC;MAC7B,CAAC;IAAA,CAAC,CAAC,CACDT,UAAU,IAAC,UAACU,KAAK,EAAK;MAAA;MAAA;MACpB,IAAMC,QAAQ,GAAGT,WAAW,EAAE;MAC9B,IAAMU,MAAM,GAAGb,OAAO,CAAC;QAAA,OAAMO,SAAS,CAACI,KAAK,CAAC;MAAA,GAAE,CAACA,KAAK,CAAC,CAAC;MAEvD,IAAMG,OAAO,GAAGd,OAAO,CAAC;QAAA,OAAMa,MAAM,CAACC,OAAO;MAAA,GAAE,CAACD,MAAM,CAACC,OAAO,CAAC,CAAC;MAC/D,IAAMC,aAAa,GAAGf,OAAO,CAAC;QAAA;QAAA,gCAAMa,MAAM,CAACE,aAAa,yEAAI,IAAI;MAAA,GAAE,CAChEF,MAAM,CAACE,aAAa,CACrB,CAAC;MAEF,IAAMC,SAAS,GAAGF,OAAO,4BACrBH,KAAK,CAACD,mBAAmB,oFAAzB,sBAA2BO,qBAAqB,2DAAhD,uBAAmDH,OAAO,CAAC,GAC3D,KAAK;MAET,IAAMI,QAAQ,GAAGJ,OAAO,6BACpBH,KAAK,CAACD,mBAAmB,qFAAzB,uBAA2BS,oBAAoB,2DAA/C,uBAAkDL,OAAO,CAAC,GAC1D,KAAK;MAET,IAAMM,kBAAkB,GAAGN,OAAO,6BAC9BH,KAAK,CAACD,mBAAmB,qFAAzB,uBAA2BW,IAAI,2DAA/B,uBAAkCP,OAAO,CAAC,GAC1C,IAAI;MAER,IAAMQ,eAAe,GACnBR,OAAO,IAAI,CAACM,kBAAkB,IAAI,CAACJ,SAAS,IAAI,CAACE,QAAQ;MAE3DnB,SAAS,CAAC,YAAM;QACd,IAAIqB,kBAAkB,EAAE;UACtBR,QAAQ,CAACP,mBAAmB,CAACS,OAAO,CAAC,CAAC;QACxC;QACA;MACF,CAAC,EAAE,CAACC,aAAa,CAAC,CAAC;MAEnBhB,SAAS,CAAC,YAAM;QACd,IAAIuB,eAAe,EAAE;UACnBV,QAAQ,CAACR,gBAAgB,CAACU,OAAO,EAAEC,aAAa,CAAC,CAAC;QACpD;MACF,CAAC,CAAC;MAEF,OACE,MAAC,gBAAgB,eACXJ,KAAK;QACT,kBAAkB,EAAES,kBAAmB;QACvC,wBAAwB,EAAEJ,SAAU;QAAA;QAAA;UAAA;UAAA;UAAA;QAAA;MAAA,GACpC;IAEN,CAAC;MAAA,QA3CkBb,WAAW;IAAA,GA2C5B,CACH;EACH,CAAC;AACH;AAEA,eAAeG,2BAA2B"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}