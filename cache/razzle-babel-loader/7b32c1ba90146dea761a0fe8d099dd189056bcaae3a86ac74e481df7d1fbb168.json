{"ast":null,"code":"import _slicedToArray from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _extends from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/extends.js\";\nimport _defineProperty from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _toConsumableArray from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _objectWithoutProperties from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nimport _omit from \"lodash/omit\";\nimport _isEqual from \"lodash/isEqual\";\nimport _isEmpty from \"lodash/isEmpty\";\nvar _excluded = [\"element\", \"attributes\", \"extras\"],\n  _excluded2 = [\"children\"];\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/node_modules/@plone/volto/packages/volto-slate/src/editor/render.jsx\",\n  _this = this;\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport { Node, Text } from 'slate';\nimport cx from 'classnames';\nimport config from '@plone/volto/registry';\nvar OMITTED = ['editor', 'path'];\n\n// TODO: read, see if relevant\n// https://reactjs.org/docs/higher-order-components.html#dont-use-hocs-inside-the-render-method\nexport var Element = function Element(_ref) {\n  var element = _ref.element,\n    _ref$attributes = _ref.attributes,\n    attributes = _ref$attributes === void 0 ? {} : _ref$attributes,\n    extras = _ref.extras,\n    rest = _objectWithoutProperties(_ref, _excluded);\n  var slate = config.settings.slate;\n  var elements = slate.elements;\n  var El = elements[element.type] || elements['default'];\n  var out = Object.assign.apply(Object, [element.styleName ? {\n    className: element.styleName\n  } : {}].concat(_toConsumableArray(Object.keys(attributes || {}).map(function (k) {\n    return !_isEmpty(attributes[k]) ? _defineProperty({}, k, attributes[k]) : {};\n  }))));\n  return __jsx(El, _extends({\n    element: element\n  }, _omit(rest, OMITTED), {\n    attributes: out,\n    extras: extras,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 5\n    }\n  }));\n};\n_c = Element;\nexport var Leaf = function Leaf(_ref3) {\n  var _classNames;\n  var children = _ref3.children,\n    rest = _objectWithoutProperties(_ref3, _excluded2);\n  // console.log('rest', rest, children);\n  var attributes = rest.attributes,\n    leaf = rest.leaf,\n    mode = rest.mode;\n  var leafs = config.settings.slate.leafs;\n  children = Object.keys(leafs).reduce(function (acc, name) {\n    return Object.keys(leaf).includes(name) ? leafs[name]({\n      children: acc\n    }) : acc;\n  }, children);\n  var classNames = (_classNames = {}, _defineProperty(_classNames, \"highlight-\".concat(leaf.highlightType), mode !== 'view' && leaf.highlight), _defineProperty(_classNames, 'highlight-selection', mode !== 'view' && leaf.isSelection), _classNames);\n\n  // stylemenu support\n  for (var prop in leaf) {\n    if (prop.startsWith('style-')) {\n      classNames[prop.substring(6)] = true;\n    }\n  }\n  var klass = cx(classNames);\n  return mode === 'view' ? typeof children === 'string' ? children.split('\\n').map(function (t, i) {\n    // Softbreak support. Should do a plugin?\n    return __jsx(React.Fragment, {\n      key: \"\".concat(i),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 11\n      }\n    }, children.indexOf('\\n') > -1 && children.split('\\n').length - 1 > i ? __jsx(React.Fragment, null, klass ? __jsx(\"span\", {\n      className: klass,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 26\n      }\n    }, t) : t, __jsx(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 17\n      }\n    })) : klass ? __jsx(\"span\", {\n      className: klass,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 15\n      }\n    }, t) : t);\n  }) : __jsx(\"span\", {\n    className: klass,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }\n  }, children) : __jsx(\"span\", _extends({}, attributes, {\n    className: klass,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 5\n    }\n  }), children);\n};\n_c2 = Leaf;\nvar serializeData = function serializeData(node) {\n  return JSON.stringify({\n    type: node.type,\n    data: node.data\n  });\n};\nexport var serializeNodes = function serializeNodes(nodes, getAttributes) {\n  var extras = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var editor = {\n    children: nodes || []\n  };\n  var _serializeNodes = function _serializeNodes(nodes) {\n    return (nodes || []).map(function (_ref4, i) {\n      var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[0],\n        path = _ref5[1];\n      return Text.isText(node) ? __jsx(Leaf, {\n        path: path,\n        leaf: node,\n        text: node,\n        mode: \"view\",\n        key: path,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 9\n        }\n      }, node.text) : __jsx(Element, {\n        path: path,\n        element: node,\n        mode: \"view\",\n        key: path,\n        \"data-slate-data\": node.data ? serializeData(node) : null,\n        attributes: _isEqual(path, [0]) ? getAttributes ? getAttributes(node, path) : null : null,\n        extras: extras,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 9\n        }\n      }, _serializeNodes(Array.from(Node.children(editor, path))));\n    });\n  };\n  return _serializeNodes(Array.from(Node.children(editor, [])));\n};\n\n/**\n * Get the concatenated text string of a node's content.\n *\n * Note that this WILL include spaces between block node leafs in contrary to\n * the original slate method. This function joins text of nodes with\n * separating spaces to produce a string for indexing purposes.\n *\n */\nvar ConcatenatedString = function ConcatenatedString(node) {\n  if (Text.isText(node)) {\n    return node.text.trim();\n  } else {\n    return node.children.map(ConcatenatedString).join(' ');\n  }\n};\n\n/**\n * @function serializeNodesToText\n *\n * @param {Array[Node]} nodes\n *\n * @returns {string}\n */\n_c3 = ConcatenatedString;\nexport var serializeNodesToText = function serializeNodesToText(nodes) {\n  return nodes.map(ConcatenatedString).join('\\n');\n};\nexport var serializeNodesToHtml = function serializeNodesToHtml(nodes) {\n  return renderToStaticMarkup(serializeNodes(nodes));\n};\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"Element\");\n$RefreshReg$(_c2, \"Leaf\");\n$RefreshReg$(_c3, \"ConcatenatedString\");","map":{"version":3,"names":["React","renderToStaticMarkup","Node","Text","cx","config","OMITTED","Element","element","attributes","extras","rest","slate","settings","elements","El","type","out","Object","assign","styleName","className","keys","map","k","Leaf","children","leaf","mode","leafs","reduce","acc","name","includes","classNames","highlightType","highlight","isSelection","prop","startsWith","substring","klass","split","t","i","indexOf","length","serializeData","node","JSON","stringify","data","serializeNodes","nodes","getAttributes","editor","_serializeNodes","path","isText","text","Array","from","ConcatenatedString","trim","join","serializeNodesToText","serializeNodesToHtml"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@plone/volto/packages/volto-slate/src/editor/render.jsx"],"sourcesContent":["import React from 'react';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport { Node, Text } from 'slate';\nimport cx from 'classnames';\nimport { isEmpty, isEqual, omit } from 'lodash';\nimport config from '@plone/volto/registry';\n\nconst OMITTED = ['editor', 'path'];\n\n// TODO: read, see if relevant\n// https://reactjs.org/docs/higher-order-components.html#dont-use-hocs-inside-the-render-method\nexport const Element = ({ element, attributes = {}, extras, ...rest }) => {\n  const { slate } = config.settings;\n  const { elements } = slate;\n  const El = elements[element.type] || elements['default'];\n\n  const out = Object.assign(\n    element.styleName ? { className: element.styleName } : {},\n    ...Object.keys(attributes || {}).map((k) =>\n      !isEmpty(attributes[k]) ? { [k]: attributes[k] } : {},\n    ),\n  );\n\n  return (\n    <El\n      element={element}\n      {...omit(rest, OMITTED)}\n      attributes={out}\n      extras={extras}\n    />\n  );\n};\n\nexport const Leaf = ({ children, ...rest }) => {\n  // console.log('rest', rest, children);\n  const { attributes, leaf, mode } = rest;\n  let { leafs } = config.settings.slate;\n\n  children = Object.keys(leafs).reduce((acc, name) => {\n    return Object.keys(leaf).includes(name)\n      ? leafs[name]({ children: acc })\n      : acc;\n  }, children);\n\n  const classNames = {\n    [`highlight-${leaf.highlightType}`]: mode !== 'view' && leaf.highlight,\n    'highlight-selection': mode !== 'view' && leaf.isSelection,\n  };\n\n  // stylemenu support\n  for (const prop in leaf) {\n    if (prop.startsWith('style-')) {\n      classNames[prop.substring(6)] = true;\n    }\n  }\n\n  const klass = cx(classNames);\n\n  return mode === 'view' ? (\n    typeof children === 'string' ? (\n      children.split('\\n').map((t, i) => {\n        // Softbreak support. Should do a plugin?\n        return (\n          <React.Fragment key={`${i}`}>\n            {children.indexOf('\\n') > -1 &&\n            children.split('\\n').length - 1 > i ? (\n              <>\n                {klass ? <span className={klass}>{t}</span> : t}\n                <br />\n              </>\n            ) : klass ? (\n              <span className={klass}>{t}</span>\n            ) : (\n              t\n            )}\n          </React.Fragment>\n        );\n      })\n    ) : (\n      <span className={klass}>{children}</span>\n    )\n  ) : (\n    <span {...attributes} className={klass}>\n      {children}\n    </span>\n  );\n};\n\nconst serializeData = (node) => {\n  return JSON.stringify({ type: node.type, data: node.data });\n};\n\nexport const serializeNodes = (nodes, getAttributes, extras = {}) => {\n  const editor = { children: nodes || [] };\n\n  const _serializeNodes = (nodes) => {\n    return (nodes || []).map(([node, path], i) => {\n      return Text.isText(node) ? (\n        <Leaf path={path} leaf={node} text={node} mode=\"view\" key={path}>\n          {node.text}\n        </Leaf>\n      ) : (\n        <Element\n          path={path}\n          element={node}\n          mode=\"view\"\n          key={path}\n          data-slate-data={node.data ? serializeData(node) : null}\n          attributes={\n            isEqual(path, [0])\n              ? getAttributes\n                ? getAttributes(node, path)\n                : null\n              : null\n          }\n          extras={extras}\n        >\n          {_serializeNodes(Array.from(Node.children(editor, path)))}\n        </Element>\n      );\n    });\n  };\n\n  return _serializeNodes(Array.from(Node.children(editor, [])));\n};\n\n/**\n * Get the concatenated text string of a node's content.\n *\n * Note that this WILL include spaces between block node leafs in contrary to\n * the original slate method. This function joins text of nodes with\n * separating spaces to produce a string for indexing purposes.\n *\n */\nconst ConcatenatedString = (node) => {\n  if (Text.isText(node)) {\n    return node.text.trim();\n  } else {\n    return node.children.map(ConcatenatedString).join(' ');\n  }\n};\n\n/**\n * @function serializeNodesToText\n *\n * @param {Array[Node]} nodes\n *\n * @returns {string}\n */\nexport const serializeNodesToText = (nodes) => {\n  return nodes.map(ConcatenatedString).join('\\n');\n};\n\nexport const serializeNodesToHtml = (nodes) =>\n  renderToStaticMarkup(serializeNodes(nodes));\n"],"mappings":";;;;;;;;;;;;;AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,oBAAoB,QAAQ,kBAAkB;AACvD,SAASC,IAAI,EAAEC,IAAI,QAAQ,OAAO;AAClC,OAAOC,EAAE,MAAM,YAAY;AAE3B,OAAOC,MAAM,MAAM,uBAAuB;AAE1C,IAAMC,OAAO,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC;;AAElC;AACA;AACA,OAAO,IAAMC,OAAO,GAAG,SAAVA,OAAO,OAAsD;EAAA,IAAhDC,OAAO,QAAPA,OAAO;IAAA,uBAAEC,UAAU;IAAVA,UAAU,gCAAG,CAAC,CAAC;IAAEC,MAAM,QAANA,MAAM;IAAKC,IAAI;EACjE,IAAQC,KAAK,GAAKP,MAAM,CAACQ,QAAQ,CAAzBD,KAAK;EACb,IAAQE,QAAQ,GAAKF,KAAK,CAAlBE,QAAQ;EAChB,IAAMC,EAAE,GAAGD,QAAQ,CAACN,OAAO,CAACQ,IAAI,CAAC,IAAIF,QAAQ,CAAC,SAAS,CAAC;EAExD,IAAMG,GAAG,GAAGC,MAAM,CAACC,MAAM,OAAbD,MAAM,GAChBV,OAAO,CAACY,SAAS,GAAG;IAAEC,SAAS,EAAEb,OAAO,CAACY;EAAU,CAAC,GAAG,CAAC,CAAC,4BACtDF,MAAM,CAACI,IAAI,CAACb,UAAU,IAAI,CAAC,CAAC,CAAC,CAACc,GAAG,CAAC,UAACC,CAAC;IAAA,OACrC,CAAC,SAAQf,UAAU,CAACe,CAAC,CAAC,CAAC,uBAAMA,CAAC,EAAGf,UAAU,CAACe,CAAC,CAAC,IAAK,CAAC,CAAC;EAAA,EACtD,GACF;EAED,OACE,MAAC,EAAE;IACD,OAAO,EAAEhB;EAAQ,GACb,MAAKG,IAAI,EAAEL,OAAO,CAAC;IACvB,UAAU,EAAEW,GAAI;IAChB,MAAM,EAAEP,MAAO;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GACf;AAEN,CAAC;AAAC,KApBWH,OAAO;AAsBpB,OAAO,IAAMkB,IAAI,GAAG,SAAPA,IAAI,QAA8B;EAAA;EAAA,IAAxBC,QAAQ,SAARA,QAAQ;IAAKf,IAAI;EACtC;EACA,IAAQF,UAAU,GAAiBE,IAAI,CAA/BF,UAAU;IAAEkB,IAAI,GAAWhB,IAAI,CAAnBgB,IAAI;IAAEC,IAAI,GAAKjB,IAAI,CAAbiB,IAAI;EAC9B,IAAMC,KAAK,GAAKxB,MAAM,CAACQ,QAAQ,CAACD,KAAK,CAA/BiB,KAAK;EAEXH,QAAQ,GAAGR,MAAM,CAACI,IAAI,CAACO,KAAK,CAAC,CAACC,MAAM,CAAC,UAACC,GAAG,EAAEC,IAAI,EAAK;IAClD,OAAOd,MAAM,CAACI,IAAI,CAACK,IAAI,CAAC,CAACM,QAAQ,CAACD,IAAI,CAAC,GACnCH,KAAK,CAACG,IAAI,CAAC,CAAC;MAAEN,QAAQ,EAAEK;IAAI,CAAC,CAAC,GAC9BA,GAAG;EACT,CAAC,EAAEL,QAAQ,CAAC;EAEZ,IAAMQ,UAAU,uEACAP,IAAI,CAACQ,aAAa,GAAKP,IAAI,KAAK,MAAM,IAAID,IAAI,CAACS,SAAS,gCACtE,qBAAqB,EAAER,IAAI,KAAK,MAAM,IAAID,IAAI,CAACU,WAAW,eAC3D;;EAED;EACA,KAAK,IAAMC,IAAI,IAAIX,IAAI,EAAE;IACvB,IAAIW,IAAI,CAACC,UAAU,CAAC,QAAQ,CAAC,EAAE;MAC7BL,UAAU,CAACI,IAAI,CAACE,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI;IACtC;EACF;EAEA,IAAMC,KAAK,GAAGrC,EAAE,CAAC8B,UAAU,CAAC;EAE5B,OAAON,IAAI,KAAK,MAAM,GACpB,OAAOF,QAAQ,KAAK,QAAQ,GAC1BA,QAAQ,CAACgB,KAAK,CAAC,IAAI,CAAC,CAACnB,GAAG,CAAC,UAACoB,CAAC,EAAEC,CAAC,EAAK;IACjC;IACA,OACE,MAAC,KAAK,CAAC,QAAQ;MAAC,GAAG,YAAKA,CAAC,CAAG;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,GACzBlB,QAAQ,CAACmB,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAC5BnB,QAAQ,CAACgB,KAAK,CAAC,IAAI,CAAC,CAACI,MAAM,GAAG,CAAC,GAAGF,CAAC,GACjC,4BACGH,KAAK,GAAG;MAAM,SAAS,EAAEA,KAAM;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,GAAEE,CAAC,CAAQ,GAAGA,CAAC,EAC/C;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,EAAM,CACL,GACDF,KAAK,GACP;MAAM,SAAS,EAAEA,KAAM;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,GAAEE,CAAC,CAAQ,GAElCA,CACD,CACc;EAErB,CAAC,CAAC,GAEF;IAAM,SAAS,EAAEF,KAAM;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GAAEf,QAAQ,CAClC,GAED,2BAAUjB,UAAU;IAAE,SAAS,EAAEgC,KAAM;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,IACpCf,QAAQ,CAEZ;AACH,CAAC;AAAC,MArDWD,IAAI;AAuDjB,IAAMsB,aAAa,GAAG,SAAhBA,aAAa,CAAIC,IAAI,EAAK;EAC9B,OAAOC,IAAI,CAACC,SAAS,CAAC;IAAElC,IAAI,EAAEgC,IAAI,CAAChC,IAAI;IAAEmC,IAAI,EAAEH,IAAI,CAACG;EAAK,CAAC,CAAC;AAC7D,CAAC;AAED,OAAO,IAAMC,cAAc,GAAG,SAAjBA,cAAc,CAAIC,KAAK,EAAEC,aAAa,EAAkB;EAAA,IAAhB5C,MAAM,uEAAG,CAAC,CAAC;EAC9D,IAAM6C,MAAM,GAAG;IAAE7B,QAAQ,EAAE2B,KAAK,IAAI;EAAG,CAAC;EAExC,IAAMG,eAAe,GAAG,SAAlBA,eAAe,CAAIH,KAAK,EAAK;IACjC,OAAO,CAACA,KAAK,IAAI,EAAE,EAAE9B,GAAG,CAAC,iBAAeqB,CAAC,EAAK;MAAA;QAAnBI,IAAI;QAAES,IAAI;MACnC,OAAOtD,IAAI,CAACuD,MAAM,CAACV,IAAI,CAAC,GACtB,MAAC,IAAI;QAAC,IAAI,EAAES,IAAK;QAAC,IAAI,EAAET,IAAK;QAAC,IAAI,EAAEA,IAAK;QAAC,IAAI,EAAC,MAAM;QAAC,GAAG,EAAES,IAAK;QAAA;QAAA;UAAA;UAAA;UAAA;QAAA;MAAA,GAC7DT,IAAI,CAACW,IAAI,CACL,GAEP,MAAC,OAAO;QACN,IAAI,EAAEF,IAAK;QACX,OAAO,EAAET,IAAK;QACd,IAAI,EAAC,MAAM;QACX,GAAG,EAAES,IAAK;QACV,mBAAiBT,IAAI,CAACG,IAAI,GAAGJ,aAAa,CAACC,IAAI,CAAC,GAAG,IAAK;QACxD,UAAU,EACR,SAAQS,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,GACdH,aAAa,GACXA,aAAa,CAACN,IAAI,EAAES,IAAI,CAAC,GACzB,IAAI,GACN,IACL;QACD,MAAM,EAAE/C,MAAO;QAAA;QAAA;UAAA;UAAA;UAAA;QAAA;MAAA,GAEd8C,eAAe,CAACI,KAAK,CAACC,IAAI,CAAC3D,IAAI,CAACwB,QAAQ,CAAC6B,MAAM,EAAEE,IAAI,CAAC,CAAC,CAAC,CAE5D;IACH,CAAC,CAAC;EACJ,CAAC;EAED,OAAOD,eAAe,CAACI,KAAK,CAACC,IAAI,CAAC3D,IAAI,CAACwB,QAAQ,CAAC6B,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;AAC/D,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMO,kBAAkB,GAAG,SAArBA,kBAAkB,CAAId,IAAI,EAAK;EACnC,IAAI7C,IAAI,CAACuD,MAAM,CAACV,IAAI,CAAC,EAAE;IACrB,OAAOA,IAAI,CAACW,IAAI,CAACI,IAAI,EAAE;EACzB,CAAC,MAAM;IACL,OAAOf,IAAI,CAACtB,QAAQ,CAACH,GAAG,CAACuC,kBAAkB,CAAC,CAACE,IAAI,CAAC,GAAG,CAAC;EACxD;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AANA,MARMF,kBAAkB;AAexB,OAAO,IAAMG,oBAAoB,GAAG,SAAvBA,oBAAoB,CAAIZ,KAAK,EAAK;EAC7C,OAAOA,KAAK,CAAC9B,GAAG,CAACuC,kBAAkB,CAAC,CAACE,IAAI,CAAC,IAAI,CAAC;AACjD,CAAC;AAED,OAAO,IAAME,oBAAoB,GAAG,SAAvBA,oBAAoB,CAAIb,KAAK;EAAA,OACxCpD,oBAAoB,CAACmD,cAAc,CAACC,KAAK,CAAC,CAAC;AAAA;AAAC;AAAA;AAAA;AAAA"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}