{"ast":null,"code":"var _jsxFileName = \"/home/tooler/code/work/forests-frontend/src/develop/volto-datablocks/src/hocs/connectToProviderDataUnfiltered.js\";\nvar __jsx = React.createElement;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { withRouter } from 'react-router';\nimport { connect, useDispatch } from 'react-redux';\nimport { getDataFromProvider } from '../actions';\nimport { getProviderUrl, getConnectorPath } from '../helpers';\n/**\n * connectToProviderData.\n *\n * @param {} getProviderUrl\n */\nexport function connectToProviderDataUnfiltered(getConfig = () => ({})) {\n  return WrappedComponent => {\n    return connect(state => ({\n      data_providers: state.data_providers\n    }))(withRouter(props => {\n      var _props$data_providers, _props$data_providers2, _props$data_providers3, _props$data_providers4, _props$data_providers5, _props$data_providers6, _props$data_providers7, _props$data_providers8, _props$data_providers9, _props$data_providers10;\n      const dispatch = useDispatch();\n      const config = useMemo(() => getConfig(props), [props]);\n      const {\n        0: mounted,\n        1: setMounted\n      } = useState(false);\n      const provider_url = useMemo(() => getProviderUrl(config.provider_url), [config.provider_url]);\n      const connectorPath = useMemo(() => getConnectorPath(provider_url), [provider_url]);\n      const provider_data = provider_url ? (_props$data_providers = props.data_providers) === null || _props$data_providers === void 0 ? void 0 : (_props$data_providers2 = _props$data_providers.data) === null || _props$data_providers2 === void 0 ? void 0 : (_props$data_providers3 = _props$data_providers2[provider_url]) === null || _props$data_providers3 === void 0 ? void 0 : _props$data_providers3._default : null;\n      const provider_metadata = provider_url ? (_props$data_providers4 = props.data_providers) === null || _props$data_providers4 === void 0 ? void 0 : (_props$data_providers5 = _props$data_providers4.metadata) === null || _props$data_providers5 === void 0 ? void 0 : (_props$data_providers6 = _props$data_providers5[provider_url]) === null || _props$data_providers6 === void 0 ? void 0 : _props$data_providers6._default : null;\n      const isPending = provider_url ? (_props$data_providers7 = props.data_providers) === null || _props$data_providers7 === void 0 ? void 0 : (_props$data_providers8 = _props$data_providers7.pendingConnectors) === null || _props$data_providers8 === void 0 ? void 0 : _props$data_providers8[connectorPath] : false;\n      const isFailed = provider_url ? (_props$data_providers9 = props.data_providers) === null || _props$data_providers9 === void 0 ? void 0 : (_props$data_providers10 = _props$data_providers9.failedConnectors) === null || _props$data_providers10 === void 0 ? void 0 : _props$data_providers10[connectorPath] : false;\n      const readyToDispatch = mounted && provider_url && !provider_data && !isPending && !isFailed;\n      useEffect(() => {\n        if (!mounted) {\n          setMounted(true);\n        }\n        if (readyToDispatch) {\n          dispatch(getDataFromProvider(provider_url));\n        }\n      }, [mounted, readyToDispatch, isPending, dispatch, provider_data, provider_url]);\n      return __jsx(WrappedComponent, _extends({}, props, {\n        provider_data: provider_data,\n        provider_metadata: provider_metadata,\n        loadingProviderData: isPending,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }\n      }));\n    }));\n  };\n}\nexport default connectToProviderDataUnfiltered;","map":{"version":3,"names":["React","useEffect","useMemo","useState","withRouter","connect","useDispatch","getDataFromProvider","getProviderUrl","getConnectorPath","connectToProviderDataUnfiltered","getConfig","WrappedComponent","state","data_providers","props","dispatch","config","mounted","setMounted","provider_url","connectorPath","provider_data","data","_default","provider_metadata","metadata","isPending","pendingConnectors","isFailed","failedConnectors","readyToDispatch"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-datablocks/src/hocs/connectToProviderDataUnfiltered.js"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\nimport { withRouter } from 'react-router';\nimport { connect, useDispatch } from 'react-redux';\nimport { getDataFromProvider } from '../actions';\nimport { getProviderUrl, getConnectorPath } from '../helpers';\n/**\n * connectToProviderData.\n *\n * @param {} getProviderUrl\n */\nexport function connectToProviderDataUnfiltered(getConfig = () => ({})) {\n  return (WrappedComponent) => {\n    return connect((state) => ({\n      data_providers: state.data_providers,\n    }))(\n      withRouter((props) => {\n        const dispatch = useDispatch();\n        const config = useMemo(() => getConfig(props), [props]);\n        const [mounted, setMounted] = useState(false);\n\n        const provider_url = useMemo(\n          () => getProviderUrl(config.provider_url),\n          [config.provider_url],\n        );\n\n        const connectorPath = useMemo(() => getConnectorPath(provider_url), [\n          provider_url,\n        ]);\n\n        const provider_data = provider_url\n          ? props.data_providers?.data?.[provider_url]?._default\n          : null;\n\n        const provider_metadata = provider_url\n          ? props.data_providers?.metadata?.[provider_url]?._default\n          : null;\n\n        const isPending = provider_url\n          ? props.data_providers?.pendingConnectors?.[connectorPath]\n          : false;\n\n        const isFailed = provider_url\n          ? props.data_providers?.failedConnectors?.[connectorPath]\n          : false;\n\n        const readyToDispatch =\n          mounted && provider_url && !provider_data && !isPending && !isFailed;\n\n        useEffect(() => {\n          if (!mounted) {\n            setMounted(true);\n          }\n\n          if (readyToDispatch) {\n            dispatch(getDataFromProvider(provider_url));\n          }\n        }, [\n          mounted,\n          readyToDispatch,\n          isPending,\n          dispatch,\n          provider_data,\n          provider_url,\n        ]);\n\n        return (\n          <WrappedComponent\n            {...props}\n            provider_data={provider_data}\n            provider_metadata={provider_metadata}\n            loadingProviderData={isPending}\n          />\n        );\n      }),\n    );\n  };\n}\n\nexport default connectToProviderDataUnfiltered;\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AAC3D,SAASC,UAAU,QAAQ,cAAc;AACzC,SAASC,OAAO,EAAEC,WAAW,QAAQ,aAAa;AAClD,SAASC,mBAAmB,QAAQ,YAAY;AAChD,SAASC,cAAc,EAAEC,gBAAgB,QAAQ,YAAY;AAC7D;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,+BAA+B,CAACC,SAAS,GAAG,OAAO,CAAC,CAAC,CAAC,EAAE;EACtE,OAAQC,gBAAgB,IAAK;IAC3B,OAAOP,OAAO,CAAEQ,KAAK,KAAM;MACzBC,cAAc,EAAED,KAAK,CAACC;IACxB,CAAC,CAAC,CAAC,CACDV,UAAU,CAAEW,KAAK,IAAK;MAAA;MACpB,MAAMC,QAAQ,GAAGV,WAAW,EAAE;MAC9B,MAAMW,MAAM,GAAGf,OAAO,CAAC,MAAMS,SAAS,CAACI,KAAK,CAAC,EAAE,CAACA,KAAK,CAAC,CAAC;MACvD,MAAM;QAAA,GAACG,OAAO;QAAA,GAAEC;MAAU,IAAIhB,QAAQ,CAAC,KAAK,CAAC;MAE7C,MAAMiB,YAAY,GAAGlB,OAAO,CAC1B,MAAMM,cAAc,CAACS,MAAM,CAACG,YAAY,CAAC,EACzC,CAACH,MAAM,CAACG,YAAY,CAAC,CACtB;MAED,MAAMC,aAAa,GAAGnB,OAAO,CAAC,MAAMO,gBAAgB,CAACW,YAAY,CAAC,EAAE,CAClEA,YAAY,CACb,CAAC;MAEF,MAAME,aAAa,GAAGF,YAAY,4BAC9BL,KAAK,CAACD,cAAc,oFAApB,sBAAsBS,IAAI,qFAA1B,uBAA6BH,YAAY,CAAC,2DAA1C,uBAA4CI,QAAQ,GACpD,IAAI;MAER,MAAMC,iBAAiB,GAAGL,YAAY,6BAClCL,KAAK,CAACD,cAAc,qFAApB,uBAAsBY,QAAQ,qFAA9B,uBAAiCN,YAAY,CAAC,2DAA9C,uBAAgDI,QAAQ,GACxD,IAAI;MAER,MAAMG,SAAS,GAAGP,YAAY,6BAC1BL,KAAK,CAACD,cAAc,qFAApB,uBAAsBc,iBAAiB,2DAAvC,uBAA0CP,aAAa,CAAC,GACxD,KAAK;MAET,MAAMQ,QAAQ,GAAGT,YAAY,6BACzBL,KAAK,CAACD,cAAc,sFAApB,uBAAsBgB,gBAAgB,4DAAtC,wBAAyCT,aAAa,CAAC,GACvD,KAAK;MAET,MAAMU,eAAe,GACnBb,OAAO,IAAIE,YAAY,IAAI,CAACE,aAAa,IAAI,CAACK,SAAS,IAAI,CAACE,QAAQ;MAEtE5B,SAAS,CAAC,MAAM;QACd,IAAI,CAACiB,OAAO,EAAE;UACZC,UAAU,CAAC,IAAI,CAAC;QAClB;QAEA,IAAIY,eAAe,EAAE;UACnBf,QAAQ,CAACT,mBAAmB,CAACa,YAAY,CAAC,CAAC;QAC7C;MACF,CAAC,EAAE,CACDF,OAAO,EACPa,eAAe,EACfJ,SAAS,EACTX,QAAQ,EACRM,aAAa,EACbF,YAAY,CACb,CAAC;MAEF,OACE,MAAC,gBAAgB,eACXL,KAAK;QACT,aAAa,EAAEO,aAAc;QAC7B,iBAAiB,EAAEG,iBAAkB;QACrC,mBAAmB,EAAEE,SAAU;QAAA;QAAA;UAAA;UAAA;UAAA;QAAA;MAAA,GAC/B;IAEN,CAAC,CAAC,CACH;EACH,CAAC;AACH;AAEA,eAAejB,+BAA+B"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}