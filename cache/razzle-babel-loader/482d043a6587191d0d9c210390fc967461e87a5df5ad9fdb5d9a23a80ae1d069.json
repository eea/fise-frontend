{"ast":null,"code":"import _toConsumableArray from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\n/* eslint no-console: [\"error\", { allow: [\"error\"] }] */\nexport default (function (config) {\n  var settings = config.settings;\n  var corsProxyPath = settings.corsProxyPath || '/cors-proxy';\n  var env_destinations = (process.env.RAZZLE_ALLOWED_CORS_DESTINATIONS || '').split(',').map(function (s) {\n    return s.trim();\n  }).filter(function (s) {\n    return s.length > 0;\n  });\n\n  // Update allowed_cors_destinations with RAZZLE_ALLOWED_CORS_DESTINATIONS\n  config.settings.allowed_cors_destinations = [].concat(_toConsumableArray(config.settings.allowed_cors_destinations || []), _toConsumableArray(env_destinations));\n  if (__SERVER__) {\n    var proxy = require('http-proxy-middleware');\n    var express = require('express');\n    var middleware = express.Router();\n    var options = {\n      logLevel: 'silent',\n      followRedirects: true,\n      changeOrigin: true,\n      target: 'http://volto-cors-proxy.eea.europa.eu',\n      router: function router(req) {\n        var allowed_cors_destinations = _toConsumableArray(config.settings.allowed_cors_destinations);\n        var url = new URL(req.params['0']);\n        var target = allowed_cors_destinations.indexOf(url.hostname) > -1 ? \"\".concat(url.protocol, \"//\").concat(url.hostname).concat(url.port ? \":\".concat(url.port) : '') : null;\n        return target;\n      },\n      pathRewrite: function pathRewrite(path, req) {\n        var reqpath = path.slice(corsProxyPath.length + 1);\n        var url = new URL(reqpath);\n        var rewpath = \"\".concat(url.pathname).concat(url.search || '');\n        return rewpath;\n      },\n      onError: function onError(err, req, res) {\n        console.error('proxy error', err);\n        throw new Error(err);\n      }\n    };\n    middleware.all(\"\".concat(corsProxyPath, \"/*\"), proxy.createProxyMiddleware(options));\n    middleware.id = 'cors-proxy';\n    settings.expressMiddleware.push(middleware);\n  }\n  return config;\n});","map":{"version":3,"names":["config","settings","corsProxyPath","env_destinations","process","env","RAZZLE_ALLOWED_CORS_DESTINATIONS","split","map","s","trim","filter","length","allowed_cors_destinations","__SERVER__","proxy","require","express","middleware","Router","options","logLevel","followRedirects","changeOrigin","target","router","req","url","URL","params","indexOf","hostname","protocol","port","pathRewrite","path","reqpath","slice","rewpath","pathname","search","onError","err","res","console","error","Error","all","createProxyMiddleware","id","expressMiddleware","push"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@eeacms/volto-corsproxy/src/index.js"],"sourcesContent":["/* eslint no-console: [\"error\", { allow: [\"error\"] }] */\nexport default (config) => {\n  const { settings } = config;\n  const corsProxyPath = settings.corsProxyPath || '/cors-proxy';\n\n  const env_destinations = (process.env.RAZZLE_ALLOWED_CORS_DESTINATIONS || '')\n    .split(',')\n    .map((s) => s.trim())\n    .filter((s) => s.length > 0);\n\n  // Update allowed_cors_destinations with RAZZLE_ALLOWED_CORS_DESTINATIONS\n  config.settings.allowed_cors_destinations = [\n    ...(config.settings.allowed_cors_destinations || []),\n    ...env_destinations,\n  ];\n\n  if (__SERVER__) {\n    const proxy = require('http-proxy-middleware');\n    const express = require('express');\n    const middleware = express.Router();\n    const options = {\n      logLevel: 'silent',\n      followRedirects: true,\n      changeOrigin: true,\n      target: 'http://volto-cors-proxy.eea.europa.eu',\n      router: (req) => {\n        const allowed_cors_destinations = [\n          ...config.settings.allowed_cors_destinations,\n        ];\n\n        const url = new URL(req.params['0']);\n        const target =\n          allowed_cors_destinations.indexOf(url.hostname) > -1\n            ? `${url.protocol}//${url.hostname}${\n                url.port ? `:${url.port}` : ''\n              }`\n            : null;\n        return target;\n      },\n      pathRewrite: (path, req) => {\n        const reqpath = path.slice(corsProxyPath.length + 1);\n        const url = new URL(reqpath);\n        const rewpath = `${url.pathname}${url.search || ''}`;\n        return rewpath;\n      },\n      onError: (err, req, res) => {\n        console.error('proxy error', err);\n        throw new Error(err);\n      },\n    };\n    middleware.all(`${corsProxyPath}/*`, proxy.createProxyMiddleware(options));\n    middleware.id = 'cors-proxy';\n    settings.expressMiddleware.push(middleware);\n  }\n\n  return config;\n};\n"],"mappings":";AAAA;AACA,gBAAe,UAACA,MAAM,EAAK;EACzB,IAAQC,QAAQ,GAAKD,MAAM,CAAnBC,QAAQ;EAChB,IAAMC,aAAa,GAAGD,QAAQ,CAACC,aAAa,IAAI,aAAa;EAE7D,IAAMC,gBAAgB,GAAG,CAACC,OAAO,CAACC,GAAG,CAACC,gCAAgC,IAAI,EAAE,EACzEC,KAAK,CAAC,GAAG,CAAC,CACVC,GAAG,CAAC,UAACC,CAAC;IAAA,OAAKA,CAAC,CAACC,IAAI,EAAE;EAAA,EAAC,CACpBC,MAAM,CAAC,UAACF,CAAC;IAAA,OAAKA,CAAC,CAACG,MAAM,GAAG,CAAC;EAAA,EAAC;;EAE9B;EACAZ,MAAM,CAACC,QAAQ,CAACY,yBAAyB,gCACnCb,MAAM,CAACC,QAAQ,CAACY,yBAAyB,IAAI,EAAE,sBAChDV,gBAAgB,EACpB;EAED,IAAIW,UAAU,EAAE;IACd,IAAMC,KAAK,GAAGC,OAAO,CAAC,uBAAuB,CAAC;IAC9C,IAAMC,OAAO,GAAGD,OAAO,CAAC,SAAS,CAAC;IAClC,IAAME,UAAU,GAAGD,OAAO,CAACE,MAAM,EAAE;IACnC,IAAMC,OAAO,GAAG;MACdC,QAAQ,EAAE,QAAQ;MAClBC,eAAe,EAAE,IAAI;MACrBC,YAAY,EAAE,IAAI;MAClBC,MAAM,EAAE,uCAAuC;MAC/CC,MAAM,EAAE,gBAACC,GAAG,EAAK;QACf,IAAMb,yBAAyB,sBAC1Bb,MAAM,CAACC,QAAQ,CAACY,yBAAyB,CAC7C;QAED,IAAMc,GAAG,GAAG,IAAIC,GAAG,CAACF,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAAC;QACpC,IAAML,MAAM,GACVX,yBAAyB,CAACiB,OAAO,CAACH,GAAG,CAACI,QAAQ,CAAC,GAAG,CAAC,CAAC,aAC7CJ,GAAG,CAACK,QAAQ,eAAKL,GAAG,CAACI,QAAQ,SAC9BJ,GAAG,CAACM,IAAI,cAAON,GAAG,CAACM,IAAI,IAAK,EAAE,IAEhC,IAAI;QACV,OAAOT,MAAM;MACf,CAAC;MACDU,WAAW,EAAE,qBAACC,IAAI,EAAET,GAAG,EAAK;QAC1B,IAAMU,OAAO,GAAGD,IAAI,CAACE,KAAK,CAACnC,aAAa,CAACU,MAAM,GAAG,CAAC,CAAC;QACpD,IAAMe,GAAG,GAAG,IAAIC,GAAG,CAACQ,OAAO,CAAC;QAC5B,IAAME,OAAO,aAAMX,GAAG,CAACY,QAAQ,SAAGZ,GAAG,CAACa,MAAM,IAAI,EAAE,CAAE;QACpD,OAAOF,OAAO;MAChB,CAAC;MACDG,OAAO,EAAE,iBAACC,GAAG,EAAEhB,GAAG,EAAEiB,GAAG,EAAK;QAC1BC,OAAO,CAACC,KAAK,CAAC,aAAa,EAAEH,GAAG,CAAC;QACjC,MAAM,IAAII,KAAK,CAACJ,GAAG,CAAC;MACtB;IACF,CAAC;IACDxB,UAAU,CAAC6B,GAAG,WAAI7C,aAAa,SAAMa,KAAK,CAACiC,qBAAqB,CAAC5B,OAAO,CAAC,CAAC;IAC1EF,UAAU,CAAC+B,EAAE,GAAG,YAAY;IAC5BhD,QAAQ,CAACiD,iBAAiB,CAACC,IAAI,CAACjC,UAAU,CAAC;EAC7C;EAEA,OAAOlB,MAAM;AACf,CAAC"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}