{"ast":null,"code":"/**\n * Sitemap helper.\n * @module helpers/Sitemap\n */\n\nimport superagent from 'superagent';\nimport config from '@plone/volto/registry';\nimport { addHeadersFactory } from '@plone/volto/helpers/Proxy/Proxy';\n\n/**\n * Get a resource image/file with authenticated (if token exist) API headers\n * @function getAPIResourceWithAuth\n * @param {Object} req Request object\n * @return {string} The response with the image\n */\nexport var getAPIResourceWithAuth = function getAPIResourceWithAuth(req) {\n  return new Promise(function (resolve, reject) {\n    var settings = config.settings;\n    var APISUFIX = settings.legacyTraverse ? '' : '/++api++';\n    var apiPath = '';\n    if (settings.internalApiPath && __SERVER__) {\n      apiPath = settings.internalApiPath;\n    } else if (__DEVELOPMENT__ && settings.devProxyToApiPath) {\n      apiPath = settings.devProxyToApiPath;\n    } else {\n      apiPath = settings.apiPath;\n    }\n    var request = superagent.get(\"\".concat(apiPath).concat(APISUFIX).concat(req.path)).maxResponseSize(settings.maxResponseSize).responseType('blob');\n    var authToken = req.universalCookies.get('auth_token');\n    if (authToken) {\n      request.set('Authorization', \"Bearer \".concat(authToken));\n    }\n    request.use(addHeadersFactory(req));\n    request.then(resolve)[\"catch\"](reject);\n  });\n};","map":{"version":3,"names":["superagent","config","addHeadersFactory","getAPIResourceWithAuth","req","Promise","resolve","reject","settings","APISUFIX","legacyTraverse","apiPath","internalApiPath","__SERVER__","__DEVELOPMENT__","devProxyToApiPath","request","get","path","maxResponseSize","responseType","authToken","universalCookies","set","use","then"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@plone/volto/src/helpers/Api/APIResourceWithAuth.js"],"sourcesContent":["/**\n * Sitemap helper.\n * @module helpers/Sitemap\n */\n\nimport superagent from 'superagent';\nimport config from '@plone/volto/registry';\nimport { addHeadersFactory } from '@plone/volto/helpers/Proxy/Proxy';\n\n/**\n * Get a resource image/file with authenticated (if token exist) API headers\n * @function getAPIResourceWithAuth\n * @param {Object} req Request object\n * @return {string} The response with the image\n */\nexport const getAPIResourceWithAuth = (req) =>\n  new Promise((resolve, reject) => {\n    const { settings } = config;\n    const APISUFIX = settings.legacyTraverse ? '' : '/++api++';\n\n    let apiPath = '';\n    if (settings.internalApiPath && __SERVER__) {\n      apiPath = settings.internalApiPath;\n    } else if (__DEVELOPMENT__ && settings.devProxyToApiPath) {\n      apiPath = settings.devProxyToApiPath;\n    } else {\n      apiPath = settings.apiPath;\n    }\n    const request = superagent\n      .get(`${apiPath}${APISUFIX}${req.path}`)\n      .maxResponseSize(settings.maxResponseSize)\n      .responseType('blob');\n    const authToken = req.universalCookies.get('auth_token');\n    if (authToken) {\n      request.set('Authorization', `Bearer ${authToken}`);\n    }\n    request.use(addHeadersFactory(req));\n    request.then(resolve).catch(reject);\n  });\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,OAAOA,UAAU,MAAM,YAAY;AACnC,OAAOC,MAAM,MAAM,uBAAuB;AAC1C,SAASC,iBAAiB,QAAQ,kCAAkC;;AAEpE;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,IAAMC,sBAAsB,GAAG,SAAzBA,sBAAsB,CAAIC,GAAG;EAAA,OACxC,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;IAC/B,IAAQC,QAAQ,GAAKP,MAAM,CAAnBO,QAAQ;IAChB,IAAMC,QAAQ,GAAGD,QAAQ,CAACE,cAAc,GAAG,EAAE,GAAG,UAAU;IAE1D,IAAIC,OAAO,GAAG,EAAE;IAChB,IAAIH,QAAQ,CAACI,eAAe,IAAIC,UAAU,EAAE;MAC1CF,OAAO,GAAGH,QAAQ,CAACI,eAAe;IACpC,CAAC,MAAM,IAAIE,eAAe,IAAIN,QAAQ,CAACO,iBAAiB,EAAE;MACxDJ,OAAO,GAAGH,QAAQ,CAACO,iBAAiB;IACtC,CAAC,MAAM;MACLJ,OAAO,GAAGH,QAAQ,CAACG,OAAO;IAC5B;IACA,IAAMK,OAAO,GAAGhB,UAAU,CACvBiB,GAAG,WAAIN,OAAO,SAAGF,QAAQ,SAAGL,GAAG,CAACc,IAAI,EAAG,CACvCC,eAAe,CAACX,QAAQ,CAACW,eAAe,CAAC,CACzCC,YAAY,CAAC,MAAM,CAAC;IACvB,IAAMC,SAAS,GAAGjB,GAAG,CAACkB,gBAAgB,CAACL,GAAG,CAAC,YAAY,CAAC;IACxD,IAAII,SAAS,EAAE;MACbL,OAAO,CAACO,GAAG,CAAC,eAAe,mBAAYF,SAAS,EAAG;IACrD;IACAL,OAAO,CAACQ,GAAG,CAACtB,iBAAiB,CAACE,GAAG,CAAC,CAAC;IACnCY,OAAO,CAACS,IAAI,CAACnB,OAAO,CAAC,SAAM,CAACC,MAAM,CAAC;EACrC,CAAC,CAAC;AAAA"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}