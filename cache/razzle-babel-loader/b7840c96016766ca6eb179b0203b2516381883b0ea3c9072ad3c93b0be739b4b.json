{"ast":null,"code":"/* eslint no-console: [\"error\", { allow: [\"error\"] }] */\nexport default (config => {\n  const {\n    settings\n  } = config;\n  const corsProxyPath = settings.corsProxyPath || '/cors-proxy';\n  const env_destinations = (process.env.RAZZLE_ALLOWED_CORS_DESTINATIONS || '').split(',').map(s => s.trim()).filter(s => s.length > 0);\n\n  // Update allowed_cors_destinations with RAZZLE_ALLOWED_CORS_DESTINATIONS\n  config.settings.allowed_cors_destinations = [...(config.settings.allowed_cors_destinations || []), ...env_destinations];\n  if (__SERVER__) {\n    const proxy = require('http-proxy-middleware');\n    const express = require('express');\n    const middleware = express.Router();\n    const options = {\n      logLevel: 'silent',\n      followRedirects: true,\n      changeOrigin: true,\n      target: 'http://volto-cors-proxy.eea.europa.eu',\n      router: req => {\n        const allowed_cors_destinations = [...config.settings.allowed_cors_destinations];\n        const url = new URL(req.params['0']);\n        const target = allowed_cors_destinations.indexOf(url.hostname) > -1 ? `${url.protocol}//${url.hostname}${url.port ? `:${url.port}` : ''}` : null;\n        return target;\n      },\n      pathRewrite: (path, req) => {\n        const reqpath = path.slice(corsProxyPath.length + 1);\n        const url = new URL(reqpath);\n        const rewpath = `${url.pathname}${url.search || ''}`;\n        return rewpath;\n      },\n      onError: (err, req, res) => {\n        console.error('proxy error', err);\n        throw new Error(err);\n      }\n    };\n    middleware.all(`${corsProxyPath}/*`, proxy.createProxyMiddleware(options));\n    middleware.id = 'cors-proxy';\n    settings.expressMiddleware.push(middleware);\n  }\n  return config;\n});","map":{"version":3,"names":["config","settings","corsProxyPath","env_destinations","process","env","RAZZLE_ALLOWED_CORS_DESTINATIONS","split","map","s","trim","filter","length","allowed_cors_destinations","__SERVER__","proxy","require","express","middleware","Router","options","logLevel","followRedirects","changeOrigin","target","router","req","url","URL","params","indexOf","hostname","protocol","port","pathRewrite","path","reqpath","slice","rewpath","pathname","search","onError","err","res","console","error","Error","all","createProxyMiddleware","id","expressMiddleware","push"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-corsproxy/src/index.js"],"sourcesContent":["/* eslint no-console: [\"error\", { allow: [\"error\"] }] */\nexport default (config) => {\n  const { settings } = config;\n  const corsProxyPath = settings.corsProxyPath || '/cors-proxy';\n\n  const env_destinations = (process.env.RAZZLE_ALLOWED_CORS_DESTINATIONS || '')\n    .split(',')\n    .map((s) => s.trim())\n    .filter((s) => s.length > 0);\n\n  // Update allowed_cors_destinations with RAZZLE_ALLOWED_CORS_DESTINATIONS\n  config.settings.allowed_cors_destinations = [\n    ...(config.settings.allowed_cors_destinations || []),\n    ...env_destinations,\n  ];\n\n  if (__SERVER__) {\n    const proxy = require('http-proxy-middleware');\n    const express = require('express');\n    const middleware = express.Router();\n    const options = {\n      logLevel: 'silent',\n      followRedirects: true,\n      changeOrigin: true,\n      target: 'http://volto-cors-proxy.eea.europa.eu',\n      router: (req) => {\n        const allowed_cors_destinations = [\n          ...config.settings.allowed_cors_destinations,\n        ];\n\n        const url = new URL(req.params['0']);\n        const target =\n          allowed_cors_destinations.indexOf(url.hostname) > -1\n            ? `${url.protocol}//${url.hostname}${\n                url.port ? `:${url.port}` : ''\n              }`\n            : null;\n        return target;\n      },\n      pathRewrite: (path, req) => {\n        const reqpath = path.slice(corsProxyPath.length + 1);\n        const url = new URL(reqpath);\n        const rewpath = `${url.pathname}${url.search || ''}`;\n        return rewpath;\n      },\n      onError: (err, req, res) => {\n        console.error('proxy error', err);\n        throw new Error(err);\n      },\n    };\n    middleware.all(`${corsProxyPath}/*`, proxy.createProxyMiddleware(options));\n    middleware.id = 'cors-proxy';\n    settings.expressMiddleware.push(middleware);\n  }\n\n  return config;\n};\n"],"mappings":"AAAA;AACA,gBAAgBA,MAAM,IAAK;EACzB,MAAM;IAAEC;EAAS,CAAC,GAAGD,MAAM;EAC3B,MAAME,aAAa,GAAGD,QAAQ,CAACC,aAAa,IAAI,aAAa;EAE7D,MAAMC,gBAAgB,GAAG,CAACC,OAAO,CAACC,GAAG,CAACC,gCAAgC,IAAI,EAAE,EACzEC,KAAK,CAAC,GAAG,CAAC,CACVC,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,EAAE,CAAC,CACpBC,MAAM,CAAEF,CAAC,IAAKA,CAAC,CAACG,MAAM,GAAG,CAAC,CAAC;;EAE9B;EACAZ,MAAM,CAACC,QAAQ,CAACY,yBAAyB,GAAG,CAC1C,IAAIb,MAAM,CAACC,QAAQ,CAACY,yBAAyB,IAAI,EAAE,CAAC,EACpD,GAAGV,gBAAgB,CACpB;EAED,IAAIW,UAAU,EAAE;IACd,MAAMC,KAAK,GAAGC,OAAO,CAAC,uBAAuB,CAAC;IAC9C,MAAMC,OAAO,GAAGD,OAAO,CAAC,SAAS,CAAC;IAClC,MAAME,UAAU,GAAGD,OAAO,CAACE,MAAM,EAAE;IACnC,MAAMC,OAAO,GAAG;MACdC,QAAQ,EAAE,QAAQ;MAClBC,eAAe,EAAE,IAAI;MACrBC,YAAY,EAAE,IAAI;MAClBC,MAAM,EAAE,uCAAuC;MAC/CC,MAAM,EAAGC,GAAG,IAAK;QACf,MAAMb,yBAAyB,GAAG,CAChC,GAAGb,MAAM,CAACC,QAAQ,CAACY,yBAAyB,CAC7C;QAED,MAAMc,GAAG,GAAG,IAAIC,GAAG,CAACF,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAAC;QACpC,MAAML,MAAM,GACVX,yBAAyB,CAACiB,OAAO,CAACH,GAAG,CAACI,QAAQ,CAAC,GAAG,CAAC,CAAC,GAC/C,GAAEJ,GAAG,CAACK,QAAS,KAAIL,GAAG,CAACI,QAAS,GAC/BJ,GAAG,CAACM,IAAI,GAAI,IAAGN,GAAG,CAACM,IAAK,EAAC,GAAG,EAC7B,EAAC,GACF,IAAI;QACV,OAAOT,MAAM;MACf,CAAC;MACDU,WAAW,EAAE,CAACC,IAAI,EAAET,GAAG,KAAK;QAC1B,MAAMU,OAAO,GAAGD,IAAI,CAACE,KAAK,CAACnC,aAAa,CAACU,MAAM,GAAG,CAAC,CAAC;QACpD,MAAMe,GAAG,GAAG,IAAIC,GAAG,CAACQ,OAAO,CAAC;QAC5B,MAAME,OAAO,GAAI,GAAEX,GAAG,CAACY,QAAS,GAAEZ,GAAG,CAACa,MAAM,IAAI,EAAG,EAAC;QACpD,OAAOF,OAAO;MAChB,CAAC;MACDG,OAAO,EAAE,CAACC,GAAG,EAAEhB,GAAG,EAAEiB,GAAG,KAAK;QAC1BC,OAAO,CAACC,KAAK,CAAC,aAAa,EAAEH,GAAG,CAAC;QACjC,MAAM,IAAII,KAAK,CAACJ,GAAG,CAAC;MACtB;IACF,CAAC;IACDxB,UAAU,CAAC6B,GAAG,CAAE,GAAE7C,aAAc,IAAG,EAAEa,KAAK,CAACiC,qBAAqB,CAAC5B,OAAO,CAAC,CAAC;IAC1EF,UAAU,CAAC+B,EAAE,GAAG,YAAY;IAC5BhD,QAAQ,CAACiD,iBAAiB,CAACC,IAAI,CAACjC,UAAU,CAAC;EAC7C;EAEA,OAAOlB,MAAM;AACf,CAAC"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}