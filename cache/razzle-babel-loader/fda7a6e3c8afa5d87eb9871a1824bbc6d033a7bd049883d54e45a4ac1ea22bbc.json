{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nimport ReactDOM from 'react-dom';\nimport { defineMessages } from 'react-intl'; // , defineMessages\nimport { v4 as uuid } from 'uuid';\nimport { getBlocksFieldname, getBlocksLayoutFieldname } from '@plone/volto/helpers';\nimport { makeInlineElementPlugin } from '@plone/volto-slate/elementEditor';\nimport { _insertElement } from '@plone/volto-slate/elementEditor/utils';\nimport { FootnoteEditorSchema } from './schema';\nimport { withFootnote, withBeforeInsertFragment } from './extensions';\nimport { FOOTNOTE } from '../constants';\nimport { FootnoteElement } from './render';\nimport FootnoteEditor from './FootnoteEditor';\nimport './styles.less';\nconst messages = defineMessages({\n  edit: {\n    \"id\": \"Edit footnote\",\n    \"defaultMessage\": \"Edit footnote\"\n  },\n  delete: {\n    \"id\": \"Remove footnote\",\n    \"defaultMessage\": \"Remove footnote\"\n  }\n});\nexport default function install(config) {\n  const opts = {\n    title: 'Footnote',\n    pluginId: FOOTNOTE,\n    elementType: FOOTNOTE,\n    pluginEditor: FootnoteEditor,\n    element: FootnoteElement,\n    isInlineElement: true,\n    editSchema: FootnoteEditorSchema,\n    extensions: [withFootnote, withBeforeInsertFragment],\n    hasValue: formData => !!formData.footnote,\n    insertElement: (editor, data) => {\n      var _config, _config$blocks, _config$blocks$blocks, _config$blocks$blocks2;\n      // the default behavior is _insertElement,\n      // it returns whether an element was possibly inserted\n      if (!_insertElement(FOOTNOTE)(editor, data)) {\n        return;\n      }\n      if (!editor.getBlockProps) return;\n      const {\n        properties,\n        onChangeField\n      } = editor.getBlockProps();\n\n      // the usual functions used to work with the form state data\n      const blocksFieldname = getBlocksFieldname(properties);\n      const blocksLayoutFieldname = getBlocksLayoutFieldname(properties);\n      const blocks = (properties === null || properties === void 0 ? void 0 : properties[blocksFieldname]) || {};\n      const blocks_layout = (properties === null || properties === void 0 ? void 0 : properties[blocksLayoutFieldname]) || {};\n\n      // Auto-add footnote block\n      if ((_config = config) !== null && _config !== void 0 && (_config$blocks = _config.blocks) !== null && _config$blocks !== void 0 && (_config$blocks$blocks = _config$blocks.blocksConfig) !== null && _config$blocks$blocks !== void 0 && (_config$blocks$blocks2 = _config$blocks$blocks.slateFootnotes) !== null && _config$blocks$blocks2 !== void 0 && _config$blocks$blocks2.autoAdd) {\n        // whether the footnotes block exists already\n        let footnotesBlockExists = false;\n        for (const b in blocks) {\n          const bb = blocks[b];\n          if (bb['@type'] === 'slateFootnotes') {\n            footnotesBlockExists = true;\n            break;\n          }\n        }\n        // if not, create it\n        if (!footnotesBlockExists) {\n          const id = uuid();\n          const nb = {\n            '@type': 'slateFootnotes',\n            title: 'Footnotes'\n          };\n          const formData = {\n            blocks: _objectSpread(_objectSpread({}, blocks), {}, {\n              [id]: nb\n            }),\n            blocks_layout: {\n              items: [...blocks_layout.items, id]\n            }\n          };\n          ReactDOM.unstable_batchedUpdates(() => {\n            onChangeField(blocksFieldname, formData[blocksFieldname]);\n            onChangeField(blocksLayoutFieldname, formData[blocksLayoutFieldname]);\n          });\n        }\n      }\n    },\n    messages\n  };\n  const [installFootnoteEditor] = makeInlineElementPlugin(opts);\n  config = installFootnoteEditor(config);\n  const {\n    slate\n  } = config.settings;\n  slate.toolbarButtons = [...(slate.toolbarButtons || []), 'footnote'];\n  slate.expandedToolbarButtons = [...(slate.expandedToolbarButtons || []), 'footnote'];\n  return config;\n}","map":{"version":3,"names":["ReactDOM","defineMessages","v4","uuid","getBlocksFieldname","getBlocksLayoutFieldname","makeInlineElementPlugin","_insertElement","FootnoteEditorSchema","withFootnote","withBeforeInsertFragment","FOOTNOTE","FootnoteElement","FootnoteEditor","messages","edit","delete","install","config","opts","title","pluginId","elementType","pluginEditor","element","isInlineElement","editSchema","extensions","hasValue","formData","footnote","insertElement","editor","data","getBlockProps","properties","onChangeField","blocksFieldname","blocksLayoutFieldname","blocks","blocks_layout","blocksConfig","slateFootnotes","autoAdd","footnotesBlockExists","b","bb","id","nb","items","unstable_batchedUpdates","installFootnoteEditor","slate","settings","toolbarButtons","expandedToolbarButtons"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-slate-footnote/src/editor/index.js"],"sourcesContent":["import ReactDOM from 'react-dom';\nimport { defineMessages } from 'react-intl'; // , defineMessages\nimport { v4 as uuid } from 'uuid';\nimport {\n  getBlocksFieldname,\n  getBlocksLayoutFieldname,\n} from '@plone/volto/helpers';\nimport { makeInlineElementPlugin } from '@plone/volto-slate/elementEditor';\nimport { _insertElement } from '@plone/volto-slate/elementEditor/utils';\nimport { FootnoteEditorSchema } from './schema';\nimport { withFootnote, withBeforeInsertFragment } from './extensions';\nimport { FOOTNOTE } from '../constants';\nimport { FootnoteElement } from './render';\nimport FootnoteEditor from './FootnoteEditor';\n\nimport './styles.less';\n\nconst messages = defineMessages({\n  edit: {\n    id: 'Edit footnote',\n    defaultMessage: 'Edit footnote',\n  },\n  delete: {\n    id: 'Remove footnote',\n    defaultMessage: 'Remove footnote',\n  },\n});\n\nexport default function install(config) {\n  const opts = {\n    title: 'Footnote',\n    pluginId: FOOTNOTE,\n    elementType: FOOTNOTE,\n    pluginEditor: FootnoteEditor,\n    element: FootnoteElement,\n    isInlineElement: true,\n    editSchema: FootnoteEditorSchema,\n    extensions: [withFootnote, withBeforeInsertFragment],\n    hasValue: (formData) => !!formData.footnote,\n    insertElement: (editor, data) => {\n      // the default behavior is _insertElement,\n      // it returns whether an element was possibly inserted\n      if (!_insertElement(FOOTNOTE)(editor, data)) {\n        return;\n      }\n\n      if (!editor.getBlockProps) return;\n\n      const { properties, onChangeField } = editor.getBlockProps();\n\n      // the usual functions used to work with the form state data\n      const blocksFieldname = getBlocksFieldname(properties);\n      const blocksLayoutFieldname = getBlocksLayoutFieldname(properties);\n\n      const blocks = properties?.[blocksFieldname] || {};\n      const blocks_layout = properties?.[blocksLayoutFieldname] || {};\n\n      // Auto-add footnote block\n      if (config?.blocks?.blocksConfig?.slateFootnotes?.autoAdd) {\n        // whether the footnotes block exists already\n        let footnotesBlockExists = false;\n        for (const b in blocks) {\n          const bb = blocks[b];\n          if (bb['@type'] === 'slateFootnotes') {\n            footnotesBlockExists = true;\n            break;\n          }\n        }\n        // if not, create it\n        if (!footnotesBlockExists) {\n          const id = uuid();\n          const nb = {\n            '@type': 'slateFootnotes',\n            title: 'Footnotes',\n          };\n          const formData = {\n            blocks: { ...blocks, [id]: nb },\n            blocks_layout: {\n              items: [...blocks_layout.items, id],\n            },\n          };\n\n          ReactDOM.unstable_batchedUpdates(() => {\n            onChangeField(blocksFieldname, formData[blocksFieldname]);\n            onChangeField(\n              blocksLayoutFieldname,\n              formData[blocksLayoutFieldname],\n            );\n          });\n        }\n      }\n    },\n    messages,\n  };\n  const [installFootnoteEditor] = makeInlineElementPlugin(opts);\n  config = installFootnoteEditor(config);\n\n  const { slate } = config.settings;\n\n  slate.toolbarButtons = [...(slate.toolbarButtons || []), 'footnote'];\n  slate.expandedToolbarButtons = [\n    ...(slate.expandedToolbarButtons || []),\n    'footnote',\n  ];\n\n  return config;\n}\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[{"id":"Edit footnote","defaultMessage":"Edit footnote"},{"id":"Remove footnote","defaultMessage":"Remove footnote"}]}},"sourceType":"module","externalDependencies":[]}