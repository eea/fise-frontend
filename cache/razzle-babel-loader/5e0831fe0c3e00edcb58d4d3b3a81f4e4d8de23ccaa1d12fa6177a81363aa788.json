{"ast":null,"code":"import _extends from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/extends.js\";\nimport _defineProperty from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/node_modules/@eeacms/volto-forests-theme/src/components/manage/Blocks/DiscodataConnectorBlock/v1/Edit.jsx\",\n  _this = this,\n  _s = $RefreshSig$();\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport { compose } from 'redux';\nimport _uniqueId from 'lodash/uniqueId';\nimport { v4 as uuid } from 'uuid';\nimport View from './View';\nimport { SidebarPortal } from '@plone/volto/components';\nimport InlineForm from '@plone/volto/components/manage/Form/InlineForm';\nimport { connectToMultipleProviders } from '@eeacms/volto-datablocks/hocs';\nimport { getSchema } from './schema';\nimport '../styles.css';\nvar Edit = function Edit(props) {\n  _s();\n  var _useState = useState({\n      id: _uniqueId('block_'),\n      schema: getSchema(props)\n    }),\n    state = _useState[0],\n    setState = _useState[1];\n  useEffect(function () {\n    var newData = _objectSpread({}, props.data);\n    if (props.data.data_providers) {\n      var _props$data, _props$data2, _props$data2$data_pro;\n      if (typeof ((_props$data = props.data) === null || _props$data === void 0 ? void 0 : _props$data.data_providers) === 'object' && (_props$data2 = props.data) !== null && _props$data2 !== void 0 && (_props$data2$data_pro = _props$data2.data_providers) !== null && _props$data2$data_pro !== void 0 && _props$data2$data_pro.value) {\n        try {\n          var _props$data3, _props$data3$data_pro, _dataProvidersSchema$, _dataProvidersSchema$2;\n          newData.data_providers = [];\n          var dataProvidersSchema = JSON.parse((_props$data3 = props.data) === null || _props$data3 === void 0 ? void 0 : (_props$data3$data_pro = _props$data3.data_providers) === null || _props$data3$data_pro === void 0 ? void 0 : _props$data3$data_pro.value);\n          (dataProvidersSchema === null || dataProvidersSchema === void 0 ? void 0 : (_dataProvidersSchema$ = dataProvidersSchema.fieldsets) === null || _dataProvidersSchema$ === void 0 ? void 0 : (_dataProvidersSchema$2 = _dataProvidersSchema$[0]) === null || _dataProvidersSchema$2 === void 0 ? void 0 : _dataProvidersSchema$2.fields) && dataProvidersSchema.fieldsets[0].fields.forEach(function (dataProvider) {\n            newData.data_providers.push(_objectSpread(_objectSpread({}, dataProvidersSchema.properties[dataProvider]), {}, {\n              '@id': uuid(),\n              id: dataProvider\n            }));\n          });\n        } catch (_unused) {}\n      }\n    }\n    if (JSON.stringify(newData) !== JSON.stringify(props.data)) {\n      props.onChangeBlock(props.block, _objectSpread({}, newData));\n    }\n    /* eslint-disable-next-line */\n  }, []);\n  useEffect(function () {\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      schema: getSchema(props)\n    }));\n    /* eslint-disable-next-line */\n  }, [props.providers_data, props.data.data_providers_new]);\n  return __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 5\n    }\n  }, __jsx(SidebarPortal, {\n    selected: props.selected,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 7\n    }\n  }, __jsx(InlineForm, {\n    schema: state.schema,\n    title: state.schema.title,\n    onChangeField: function onChangeField(field, data) {\n      props.onChangeBlock(props.block, _objectSpread(_objectSpread({}, props.data || {}), {}, _defineProperty({}, field, data)));\n    },\n    formData: props.data || {},\n    block: props.block,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 9\n    }\n  })), __jsx(View, _extends({}, props, {\n    editMode: true,\n    id: state.id,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }\n  })));\n};\n_s(Edit, \"1GqNlM/AV1s59DyZLlcCnVvD/+g=\");\n_c = Edit;\nexport default compose(connectToMultipleProviders(function (props) {\n  var _props$data4, _props$data4$data_pro, _props$data4$data_pro2;\n  return {\n    providers: ((_props$data4 = props.data) === null || _props$data4 === void 0 ? void 0 : (_props$data4$data_pro = _props$data4.data_providers) === null || _props$data4$data_pro === void 0 ? void 0 : (_props$data4$data_pro2 = _props$data4$data_pro.map(function (provider) {\n      return {\n        provider_url: provider.path,\n        title: provider.title\n      };\n    })) === null || _props$data4$data_pro2 === void 0 ? void 0 : _props$data4$data_pro2.filter(function (provider) {\n      return provider.provider_url;\n    })) || []\n  };\n}))(Edit);\nvar _c;\n$RefreshReg$(_c, \"Edit\");","map":{"version":3,"names":["React","useState","useEffect","compose","_uniqueId","v4","uuid","View","SidebarPortal","InlineForm","connectToMultipleProviders","getSchema","Edit","props","id","schema","state","setState","newData","data","data_providers","value","dataProvidersSchema","JSON","parse","fieldsets","fields","forEach","dataProvider","push","properties","stringify","onChangeBlock","block","providers_data","data_providers_new","selected","title","field","providers","map","provider","provider_url","path","filter"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@eeacms/volto-forests-theme/src/components/manage/Blocks/DiscodataConnectorBlock/v1/Edit.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { compose } from 'redux';\nimport _uniqueId from 'lodash/uniqueId';\nimport { v4 as uuid } from 'uuid';\nimport View from './View';\nimport { SidebarPortal } from '@plone/volto/components';\nimport InlineForm from '@plone/volto/components/manage/Form/InlineForm';\nimport { connectToMultipleProviders } from '@eeacms/volto-datablocks/hocs';\n\nimport { getSchema } from './schema';\n\nimport '../styles.css';\n\nconst Edit = (props) => {\n  const [state, setState] = useState({\n    id: _uniqueId('block_'),\n    schema: getSchema(props),\n  });\n\n  useEffect(() => {\n    const newData = { ...props.data };\n    if (props.data.data_providers) {\n      if (\n        typeof props.data?.data_providers === 'object' &&\n        props.data?.data_providers?.value\n      ) {\n        try {\n          newData.data_providers = [];\n          const dataProvidersSchema = JSON.parse(\n            props.data?.data_providers?.value,\n          );\n          dataProvidersSchema?.fieldsets?.[0]?.fields &&\n            dataProvidersSchema.fieldsets[0].fields.forEach((dataProvider) => {\n              newData.data_providers.push({\n                ...dataProvidersSchema.properties[dataProvider],\n                '@id': uuid(),\n                id: dataProvider,\n              });\n            });\n        } catch {}\n      }\n    }\n    if (JSON.stringify(newData) !== JSON.stringify(props.data)) {\n      props.onChangeBlock(props.block, {\n        ...newData,\n      });\n    }\n    /* eslint-disable-next-line */\n  }, []);\n\n  useEffect(() => {\n    setState({\n      ...state,\n      schema: getSchema(props),\n    });\n    /* eslint-disable-next-line */\n  }, [props.providers_data, props.data.data_providers_new]);\n\n  return (\n    <div>\n      <SidebarPortal selected={props.selected}>\n        <InlineForm\n          schema={state.schema}\n          title={state.schema.title}\n          onChangeField={(field, data) => {\n            props.onChangeBlock(props.block, {\n              ...(props.data || {}),\n              [field]: data,\n            });\n          }}\n          formData={props.data || {}}\n          block={props.block}\n        />\n      </SidebarPortal>\n      <View {...props} editMode id={state.id} />\n    </div>\n  );\n};\n\nexport default compose(\n  connectToMultipleProviders((props) => ({\n    providers:\n      props.data?.data_providers\n        ?.map((provider) => ({\n          provider_url: provider.path,\n          title: provider.title,\n        }))\n        ?.filter((provider) => provider.provider_url) || [],\n  })),\n)(Edit);\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}