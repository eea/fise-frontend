{"ast":null,"code":"var _jsxFileName = \"/home/tooler/code/work/forests-frontend/node_modules/volto-slate/src/widgets/HtmlSlateWidget.jsx\";\nvar __jsx = React.createElement;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n/**\n * HtmlSlateWidget, a slate widget variant that saves its data as HTML\n */\n\nimport React from 'react';\nimport ReactDOMServer from 'react-dom/server';\nimport configureStore from 'redux-mock-store';\nimport { MemoryRouter } from 'react-router-dom';\nimport { Provider, useSelector } from 'react-redux';\nimport { defineMessages, injectIntl } from 'react-intl';\nimport { FormFieldWrapper } from '@plone/volto/components';\nimport SlateEditor from 'volto-slate/editor/SlateEditor';\nimport { serializeNodes } from 'volto-slate/editor/render';\nimport { makeEditor } from 'volto-slate/utils';\nimport deserialize from 'volto-slate/editor/deserialize';\nimport { createEmptyParagraph, normalizeExternalData } from 'volto-slate/utils';\nimport { ErrorBoundary } from './ErrorBoundary';\nimport './style.css';\nconst messages = defineMessages({\n  error: {\n    \"id\": \"An error has occurred while editing \\\"{name}\\\" field. We have been notified and we are looking into it. Please save your work and retry. If the issue persists please contact the site administrator.\",\n    \"defaultMessage\": \"An error has occurred while editing \\\"{name}\\\" field. We have been notified and we are looking into it. Please save your work and retry. If the issue persists please contact the site administrator.\"\n  }\n});\nconst HtmlSlateWidget = props => {\n  const {\n    id,\n    onChange,\n    value,\n    focus,\n    className,\n    block,\n    placeholder,\n    properties,\n    intl\n  } = props;\n  const [selected, setSelected] = React.useState(focus);\n  const editor = React.useMemo(() => makeEditor(), []);\n  const token = useSelector(state => state.userSession.token);\n  const toHtml = React.useCallback(value => {\n    const mockStore = configureStore();\n    const html = ReactDOMServer.renderToStaticMarkup(__jsx(Provider, {\n      store: mockStore({\n        userSession: {\n          token\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 55,\n        columnNumber: 9\n      }\n    }, __jsx(MemoryRouter, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 11\n      }\n    }, serializeNodes(value || []))));\n    // console.log('toHtml value', JSON.stringify(value));\n    // console.log('toHtml html', html);\n\n    return {\n      'content-type': value ? value['content-type'] : 'text/html',\n      encoding: value ? value.encoding : 'utf8',\n      data: html\n    };\n  }, [token]);\n  const fromHtml = React.useCallback(value => {\n    const html = (value === null || value === void 0 ? void 0 : value.data) || '';\n    const parsed = new DOMParser().parseFromString(html, 'text/html');\n    const body = parsed.getElementsByTagName('google-sheets-html-origin').length > 0 ? parsed.querySelector('google-sheets-html-origin > table') : parsed.body;\n    let data = deserialize(editor, body);\n    data = normalizeExternalData(editor, data);\n\n    // editor.children = data;\n    // Editor.normalize(editor);\n    // TODO: need to add {text: \"\"} placeholders between elements\n    const res = data.length ? data : [createEmptyParagraph()];\n    // console.log('from html', { html: value?.data, res });\n    return res;\n  }, [editor]);\n  const valueFromHtml = React.useMemo(() => {\n    return fromHtml(value);\n  }, [value, fromHtml]);\n  const handleChange = React.useCallback(newValue => {\n    onChange(id, toHtml(newValue));\n  }, [onChange, toHtml, id]);\n  const handleClick = React.useCallback(() => {\n    setSelected(true);\n  }, []);\n  return __jsx(FormFieldWrapper, _extends({}, props, {\n    draggable: false,\n    className: \"slate_wysiwyg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 5\n    }\n  }), __jsx(\"div\", {\n    className: \"slate_wysiwyg_box\",\n    role: \"textbox\",\n    tabIndex: \"-1\",\n    style: {\n      boxSizing: 'initial'\n    },\n    onClick: handleClick,\n    onKeyDown: () => {},\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }\n  }, __jsx(ErrorBoundary, {\n    name: intl.formatMessage(messages.error, {\n      name: id\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 9\n    }\n  }, __jsx(SlateEditor, {\n    className: className,\n    id: id,\n    name: id,\n    value: valueFromHtml,\n    onChange: handleChange,\n    block: block,\n    selected: selected,\n    properties: properties,\n    placeholder: placeholder,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 11\n    }\n  }))));\n};\nexport default injectIntl(HtmlSlateWidget);","map":{"version":3,"names":["React","ReactDOMServer","configureStore","MemoryRouter","Provider","useSelector","defineMessages","injectIntl","FormFieldWrapper","SlateEditor","serializeNodes","makeEditor","deserialize","createEmptyParagraph","normalizeExternalData","ErrorBoundary","messages","error","HtmlSlateWidget","props","id","onChange","value","focus","className","block","placeholder","properties","intl","selected","setSelected","useState","editor","useMemo","token","state","userSession","toHtml","useCallback","mockStore","html","renderToStaticMarkup","encoding","data","fromHtml","parsed","DOMParser","parseFromString","body","getElementsByTagName","length","querySelector","res","valueFromHtml","handleChange","newValue","handleClick","boxSizing","formatMessage","name"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/volto-slate/src/widgets/HtmlSlateWidget.jsx"],"sourcesContent":["/**\n * HtmlSlateWidget, a slate widget variant that saves its data as HTML\n */\n\nimport React from 'react';\nimport ReactDOMServer from 'react-dom/server';\nimport configureStore from 'redux-mock-store';\nimport { MemoryRouter } from 'react-router-dom';\nimport { Provider, useSelector } from 'react-redux';\nimport { defineMessages, injectIntl } from 'react-intl';\n\nimport { FormFieldWrapper } from '@plone/volto/components';\nimport SlateEditor from 'volto-slate/editor/SlateEditor';\nimport { serializeNodes } from 'volto-slate/editor/render';\nimport { makeEditor } from 'volto-slate/utils';\nimport deserialize from 'volto-slate/editor/deserialize';\n\nimport { createEmptyParagraph, normalizeExternalData } from 'volto-slate/utils';\nimport { ErrorBoundary } from './ErrorBoundary';\n\nimport './style.css';\n\nconst messages = defineMessages({\n  error: {\n    id:\n      'An error has occurred while editing \"{name}\" field. We have been notified and we are looking into it. Please save your work and retry. If the issue persists please contact the site administrator.',\n    defaultMessage:\n      'An error has occurred while editing \"{name}\" field. We have been notified and we are looking into it. Please save your work and retry. If the issue persists please contact the site administrator.',\n  },\n});\n\nconst HtmlSlateWidget = (props) => {\n  const {\n    id,\n    onChange,\n    value,\n    focus,\n    className,\n    block,\n    placeholder,\n    properties,\n    intl,\n  } = props;\n\n  const [selected, setSelected] = React.useState(focus);\n\n  const editor = React.useMemo(() => makeEditor(), []);\n\n  const token = useSelector((state) => state.userSession.token);\n\n  const toHtml = React.useCallback(\n    (value) => {\n      const mockStore = configureStore();\n      const html = ReactDOMServer.renderToStaticMarkup(\n        <Provider store={mockStore({ userSession: { token } })}>\n          <MemoryRouter>{serializeNodes(value || [])}</MemoryRouter>\n        </Provider>,\n      );\n      // console.log('toHtml value', JSON.stringify(value));\n      // console.log('toHtml html', html);\n\n      return {\n        'content-type': value ? value['content-type'] : 'text/html',\n        encoding: value ? value.encoding : 'utf8',\n        data: html,\n      };\n    },\n    [token],\n  );\n\n  const fromHtml = React.useCallback(\n    (value) => {\n      const html = value?.data || '';\n\n      const parsed = new DOMParser().parseFromString(html, 'text/html');\n      const body =\n        parsed.getElementsByTagName('google-sheets-html-origin').length > 0\n          ? parsed.querySelector('google-sheets-html-origin > table')\n          : parsed.body;\n      let data = deserialize(editor, body);\n      data = normalizeExternalData(editor, data);\n\n      // editor.children = data;\n      // Editor.normalize(editor);\n      // TODO: need to add {text: \"\"} placeholders between elements\n      const res = data.length ? data : [createEmptyParagraph()];\n      // console.log('from html', { html: value?.data, res });\n      return res;\n    },\n    [editor],\n  );\n\n  const valueFromHtml = React.useMemo(() => {\n    return fromHtml(value);\n  }, [value, fromHtml]);\n\n  const handleChange = React.useCallback(\n    (newValue) => {\n      onChange(id, toHtml(newValue));\n    },\n    [onChange, toHtml, id],\n  );\n\n  const handleClick = React.useCallback(() => {\n    setSelected(true);\n  }, []);\n\n  return (\n    <FormFieldWrapper {...props} draggable={false} className=\"slate_wysiwyg\">\n      <div\n        className=\"slate_wysiwyg_box\"\n        role=\"textbox\"\n        tabIndex=\"-1\"\n        style={{ boxSizing: 'initial' }}\n        onClick={handleClick}\n        onKeyDown={() => {}}\n      >\n        <ErrorBoundary name={intl.formatMessage(messages.error, { name: id })}>\n          <SlateEditor\n            className={className}\n            id={id}\n            name={id}\n            value={valueFromHtml}\n            onChange={handleChange}\n            block={block}\n            selected={selected}\n            properties={properties}\n            placeholder={placeholder}\n          />\n        </ErrorBoundary>\n      </div>\n    </FormFieldWrapper>\n  );\n};\n\nexport default injectIntl(HtmlSlateWidget);\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[{"id":"An error has occurred while editing \"{name}\" field. We have been notified and we are looking into it. Please save your work and retry. If the issue persists please contact the site administrator.","defaultMessage":"An error has occurred while editing \"{name}\" field. We have been notified and we are looking into it. Please save your work and retry. If the issue persists please contact the site administrator."}]}},"sourceType":"module","externalDependencies":[]}