{"ast":null,"code":"import _slicedToArray from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nvar _s = $RefreshSig$();\nimport React from 'react';\nimport Undoo from 'undoo';\n\n// Code based on Apache-2.0 License\n// https://github.com/reaviz/reaflow/blob/78d60aa04f514947a17097c906efdbbd6bae5080/src/helpers/useUndo.ts\n\nvar useUndoManager = function useUndoManager(state, onUndoRedo, _ref) {\n  _s();\n  var maxUndoLevels = _ref.maxUndoLevels,\n    _ref$enableHotKeys = _ref.enableHotKeys,\n    enableHotKeys = _ref$enableHotKeys === void 0 ? true : _ref$enableHotKeys;\n  var _React$useState = React.useState(false),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    canUndo = _React$useState2[0],\n    setCanUndo = _React$useState2[1];\n  var _React$useState3 = React.useState(false),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    canRedo = _React$useState4[0],\n    setCanRedo = _React$useState4[1];\n  var manager = React.useRef(new Undoo({\n    maxLength: maxUndoLevels\n  }));\n  // Reference:\n  // https://reactjs.org/docs/hooks-faq.html#how-to-read-an-often-changing-value-from-usecallback\n  var callbackRef = React.useRef(onUndoRedo);\n  React.useEffect(function () {\n    callbackRef.current = onUndoRedo;\n  }, [onUndoRedo]);\n  var doUndo = React.useCallback(function () {\n    manager.current.undo(function (_ref2) {\n      var state = _ref2.state;\n      var nextUndo = manager.current.canUndo();\n      var nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n      callbackRef.current({\n        state: state,\n        type: 'undo',\n        canUndo: nextUndo,\n        canRedo: nextRedo\n      });\n    });\n  }, []);\n  React.useEffect(function () {\n    manager.current.save({\n      state: state\n    });\n    setCanUndo(manager.current.canUndo());\n    setCanRedo(manager.current.canRedo());\n  }, [state]);\n  var doRedo = React.useCallback(function () {\n    manager.current.redo(function (_ref3) {\n      var state = _ref3.state;\n      var nextUndo = manager.current.canUndo();\n      var nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n      callbackRef.current({\n        state: state,\n        type: 'redo',\n        canUndo: nextUndo,\n        canRedo: nextRedo\n      });\n    });\n  }, []);\n  var handleKeys = React.useCallback(function (event) {\n    var keyName = event.key;\n    if (keyName === 'Control' || keyName === 'Meta') {\n      // do not alert when only Control key is pressed.\n      return;\n    }\n    if (event.ctrlKey || event.metaKey) {\n      if (keyName === 'z') {\n        event.preventDefault();\n        event.stopPropagation();\n        doUndo();\n      } else if (keyName === 'y') {\n        event.preventDefault();\n        event.stopPropagation();\n        doRedo();\n      }\n    } else {\n      return;\n    }\n  }, [doUndo, doRedo]);\n  React.useEffect(function () {\n    if (!enableHotKeys) return;\n    document.addEventListener('keydown', handleKeys);\n    return function () {\n      return document.removeEventListener('keydown', handleKeys);\n    };\n  }, [enableHotKeys, handleKeys]);\n  return {\n    doUndo: doUndo,\n    doRedo: doRedo,\n    canUndo: canUndo,\n    canRedo: canRedo\n  };\n};\n_s(useUndoManager, \"nMLJoehySXEtKQq/ERiLyJvMSZQ=\");\nexport default useUndoManager;","map":{"version":3,"names":["React","Undoo","useUndoManager","state","onUndoRedo","maxUndoLevels","enableHotKeys","useState","canUndo","setCanUndo","canRedo","setCanRedo","manager","useRef","maxLength","callbackRef","useEffect","current","doUndo","useCallback","undo","nextUndo","nextRedo","type","save","doRedo","redo","handleKeys","event","keyName","key","ctrlKey","metaKey","preventDefault","stopPropagation","document","addEventListener","removeEventListener"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@plone/volto/src/helpers/UndoManager/useUndoManager.js"],"sourcesContent":["import React from 'react';\nimport Undoo from 'undoo';\n\n// Code based on Apache-2.0 License\n// https://github.com/reaviz/reaflow/blob/78d60aa04f514947a17097c906efdbbd6bae5080/src/helpers/useUndo.ts\n\nconst useUndoManager = (\n  state,\n  onUndoRedo,\n  { maxUndoLevels, enableHotKeys = true },\n) => {\n  const [canUndo, setCanUndo] = React.useState(false);\n  const [canRedo, setCanRedo] = React.useState(false);\n  const manager = React.useRef(new Undoo({ maxLength: maxUndoLevels }));\n  // Reference:\n  // https://reactjs.org/docs/hooks-faq.html#how-to-read-an-often-changing-value-from-usecallback\n  const callbackRef = React.useRef(onUndoRedo);\n  React.useEffect(() => {\n    callbackRef.current = onUndoRedo;\n  }, [onUndoRedo]);\n\n  const doUndo = React.useCallback(() => {\n    manager.current.undo(({ state }) => {\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n\n      callbackRef.current({\n        state,\n        type: 'undo',\n        canUndo: nextUndo,\n        canRedo: nextRedo,\n      });\n    });\n  }, []);\n\n  React.useEffect(() => {\n    manager.current.save({\n      state,\n    });\n\n    setCanUndo(manager.current.canUndo());\n    setCanRedo(manager.current.canRedo());\n  }, [state]);\n\n  const doRedo = React.useCallback(() => {\n    manager.current.redo(({ state }) => {\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n\n      callbackRef.current({\n        state,\n        type: 'redo',\n        canUndo: nextUndo,\n        canRedo: nextRedo,\n      });\n    });\n  }, []);\n\n  const handleKeys = React.useCallback(\n    (event) => {\n      const keyName = event.key;\n\n      if (keyName === 'Control' || keyName === 'Meta') {\n        // do not alert when only Control key is pressed.\n        return;\n      }\n      if (event.ctrlKey || event.metaKey) {\n        if (keyName === 'z') {\n          event.preventDefault();\n          event.stopPropagation();\n          doUndo();\n        } else if (keyName === 'y') {\n          event.preventDefault();\n          event.stopPropagation();\n          doRedo();\n        }\n      } else {\n        return;\n      }\n    },\n    [doUndo, doRedo],\n  );\n\n  React.useEffect(() => {\n    if (!enableHotKeys) return;\n    document.addEventListener('keydown', handleKeys);\n    return () => document.removeEventListener('keydown', handleKeys);\n  }, [enableHotKeys, handleKeys]);\n\n  return {\n    doUndo,\n    doRedo,\n    canUndo,\n    canRedo,\n  };\n};\n\nexport default useUndoManager;\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}