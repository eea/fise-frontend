{"ast":null,"code":"import _slicedToArray from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _isEqual from \"lodash/isEqual\";\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/node_modules/@eeacms/volto-slate-zotero/src/plugins/zotero/editor/ZoteroEditor.jsx\",\n  _this = this,\n  _s = $RefreshSig$();\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { ReactEditor } from 'slate-react';\nimport { setPluginOptions } from '@plone/volto-slate/actions';\nimport { ZoteroEditorSchema } from './schema';\nimport ZoteroDataWrapper from './ZoteroDataWrapper';\nexport default _s(function (props) {\n  _s();\n  var dispatch = useDispatch();\n  var _React$useState = React.useState({}),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    formData = _React$useState2[0],\n    setFormData = _React$useState2[1];\n  var editor = props.editor,\n    getActiveElement = props.getActiveElement,\n    isActiveElement = props.isActiveElement,\n    pluginId = props.pluginId,\n    insertElement = props.insertElement,\n    unwrapElement = props.unwrapElement;\n  var active = getActiveElement(editor);\n  var _active = _slicedToArray(active, 1),\n    zoteroNode = _active[0];\n  var isZotero = isActiveElement(editor);\n  var pid = \"\".concat(editor.uid, \"-\").concat(pluginId);\n\n  // Update the form data based on the current zotero\n  var zoteroRef = React.useRef(null);\n  React.useEffect(function () {\n    if (isZotero && !_isEqual(zoteroNode, zoteroRef.current)) {\n      zoteroRef.current = zoteroNode;\n      setFormData(zoteroNode.data || {});\n    } else if (!isZotero) {\n      zoteroRef.current = null;\n    }\n  }, [zoteroNode, isZotero, dispatch]);\n  var saveDataToEditor = React.useCallback(function (formData) {\n    if (formData.footnote) {\n      insertElement(editor, formData);\n    } else {\n      unwrapElement(editor);\n    }\n  }, [editor] // eslint-disable-line\n  );\n\n  var checkForCancel = function checkForCancel() {\n    if (!zoteroNode.data.footnote) {\n      unwrapElement(editor);\n    }\n  };\n  return __jsx(ZoteroDataWrapper, {\n    title: ZoteroEditorSchema.title,\n    schema: ZoteroEditorSchema,\n    formData: formData,\n    submitHandler: function submitHandler(newFormData) {\n      saveDataToEditor(newFormData);\n      dispatch(setPluginOptions(pid, {\n        show_sidebar_editor: false\n      }));\n      ReactEditor.focus(editor);\n    },\n    clearHandler: function clearHandler() {\n      setFormData({});\n      checkForCancel();\n      dispatch(setPluginOptions(pid, {\n        show_sidebar_editor: false\n      }));\n      ReactEditor.focus(editor);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 5\n    }\n  });\n}, \"pQO1D0SXo1yBEveJvl7yPINX7JY=\", false, function () {\n  return [useDispatch];\n});","map":{"version":3,"names":["React","useDispatch","ReactEditor","setPluginOptions","ZoteroEditorSchema","ZoteroDataWrapper","props","dispatch","useState","formData","setFormData","editor","getActiveElement","isActiveElement","pluginId","insertElement","unwrapElement","active","zoteroNode","isZotero","pid","uid","zoteroRef","useRef","useEffect","current","data","saveDataToEditor","useCallback","footnote","checkForCancel","title","newFormData","show_sidebar_editor","focus"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@eeacms/volto-slate-zotero/src/plugins/zotero/editor/ZoteroEditor.jsx"],"sourcesContent":["import { isEqual } from 'lodash';\nimport React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { ReactEditor } from 'slate-react';\nimport { setPluginOptions } from '@plone/volto-slate/actions';\nimport { ZoteroEditorSchema } from './schema';\nimport ZoteroDataWrapper from './ZoteroDataWrapper';\n\nexport default (props) => {\n  const dispatch = useDispatch();\n  const [formData, setFormData] = React.useState({});\n  const {\n    editor,\n    getActiveElement,\n    isActiveElement,\n    pluginId,\n    insertElement,\n    unwrapElement,\n  } = props;\n  const active = getActiveElement(editor);\n  const [zoteroNode] = active;\n  const isZotero = isActiveElement(editor);\n  const pid = `${editor.uid}-${pluginId}`;\n\n  // Update the form data based on the current zotero\n  const zoteroRef = React.useRef(null);\n  React.useEffect(() => {\n    if (isZotero && !isEqual(zoteroNode, zoteroRef.current)) {\n      zoteroRef.current = zoteroNode;\n      setFormData(zoteroNode.data || {});\n    } else if (!isZotero) {\n      zoteroRef.current = null;\n    }\n  }, [zoteroNode, isZotero, dispatch]);\n\n  const saveDataToEditor = React.useCallback(\n    (formData) => {\n      if (formData.footnote) {\n        insertElement(editor, formData);\n      } else {\n        unwrapElement(editor);\n      }\n    },\n    [editor], // eslint-disable-line\n  );\n\n  const checkForCancel = () => {\n    if (!zoteroNode.data.footnote) {\n      unwrapElement(editor);\n    }\n  };\n\n  return (\n    <ZoteroDataWrapper\n      title={ZoteroEditorSchema.title}\n      schema={ZoteroEditorSchema}\n      formData={formData}\n      submitHandler={(newFormData) => {\n        saveDataToEditor(newFormData);\n        dispatch(setPluginOptions(pid, { show_sidebar_editor: false }));\n\n        ReactEditor.focus(editor);\n      }}\n      clearHandler={() => {\n        setFormData({});\n        checkForCancel();\n        dispatch(setPluginOptions(pid, { show_sidebar_editor: false }));\n\n        ReactEditor.focus(editor);\n      }}\n    ></ZoteroDataWrapper>\n  );\n};\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}