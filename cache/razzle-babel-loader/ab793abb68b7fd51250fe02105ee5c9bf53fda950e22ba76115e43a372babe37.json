{"ast":null,"code":"var _jsxFileName = \"/home/tooler/code/work/forests-frontend/src/develop/volto-tableau/src/TableauBlock/View.jsx\";\nvar __jsx = React.createElement;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { withRouter } from 'react-router';\nimport Tableau from '@eeacms/volto-tableau/Tableau/View';\nimport config from '@plone/volto/registry';\nimport qs from 'querystring';\nimport '@eeacms/volto-tableau/less/tableau.less';\nconst getDevice = (config, width) => {\n  const breakpoints = config.blocks.blocksConfig.tableau_block.breakpoints;\n  let device = 'default';\n  Object.keys(breakpoints).forEach(breakpoint => {\n    if (width <= breakpoints[breakpoint][0] && width >= breakpoints[breakpoint][1]) {\n      device = breakpoint;\n    }\n  });\n  return device;\n};\nconst View = props => {\n  var _screen$page, _breakpointUrls$filte;\n  const [error, setError] = React.useState(null);\n  const [loaded, setLoaded] = React.useState(null);\n  const [mounted, setMounted] = React.useState(false);\n  const [extraFilters, setExtraFilters] = React.useState({});\n  const {\n    data = {},\n    query = {},\n    screen = {}\n  } = props;\n  const {\n    breakpointUrls = [],\n    urlParameters = [],\n    title = null,\n    description = null,\n    autoScale = false\n  } = data;\n  const version = props.data.version || config.settings.tableauVersion || '2.8.0';\n  const device = getDevice(config, ((_screen$page = screen.page) === null || _screen$page === void 0 ? void 0 : _screen$page.width) || Infinity);\n  const breakpointUrl = (_breakpointUrls$filte = breakpointUrls.filter(breakpoint => breakpoint.device === device)[0]) === null || _breakpointUrls$filte === void 0 ? void 0 : _breakpointUrls$filte.url;\n  const url = breakpointUrl || data.url;\n  React.useEffect(() => {\n    setMounted(true);\n    /* eslint-disable-next-line */\n  }, []);\n  React.useEffect(() => {\n    const newExtraFilters = _objectSpread({}, extraFilters);\n    urlParameters.forEach(element => {\n      if (element.field && typeof query[element.urlParam] !== 'undefined') {\n        newExtraFilters[element.field] = query[element.urlParam];\n      } else if (newExtraFilters[element.field]) {\n        delete newExtraFilters[element.field];\n      }\n    });\n    setExtraFilters(newExtraFilters);\n    /* eslint-disable-next-line */\n  }, [JSON.stringify(query), JSON.stringify(urlParameters)]);\n  return mounted ? __jsx(\"div\", {\n    className: \"tableau-block\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 5\n    }\n  }, props.mode === 'edit' ? __jsx(\"div\", {\n    className: \"tableau-info\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }\n  }, __jsx(\"h3\", {\n    className: \"tableau-version\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 11\n    }\n  }, \"== Tableau \", version, \" ==\"), !props.data.url ? __jsx(\"p\", {\n    className: \"tableau-error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 30\n    }\n  }, \"URL required\") : '', error ? __jsx(\"p\", {\n    className: \"tableau-error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 20\n    }\n  }, error) : '') : '', loaded && title ? __jsx(\"h3\", {\n    className: \"tableau-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 26\n    }\n  }, title) : '', loaded && description ? __jsx(\"p\", {\n    className: \"tableau-description\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }\n  }, description) : '', __jsx(Tableau, _extends({}, props, {\n    canUpdateUrl: !breakpointUrl,\n    extraFilters: extraFilters,\n    extraOptions: {\n      device: autoScale ? 'desktop' : device\n    },\n    error: error,\n    loaded: loaded,\n    setError: setError,\n    setLoaded: setLoaded,\n    version: version,\n    url: url,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }\n  }))) : '';\n};\nexport default compose(connect((state, props) => {\n  var _state$router$locatio, _state$router$locatio2, _state$discodata_quer;\n  return {\n    query: _objectSpread(_objectSpread({}, qs.parse((_state$router$locatio = state.router.location) === null || _state$router$locatio === void 0 ? void 0 : (_state$router$locatio2 = _state$router$locatio.search) === null || _state$router$locatio2 === void 0 ? void 0 : _state$router$locatio2.replace('?', '')) || {}), ((_state$discodata_quer = state.discodata_query) === null || _state$discodata_quer === void 0 ? void 0 : _state$discodata_quer.search) || {}),\n    screen: state.screen\n  };\n}))(withRouter(View));","map":{"version":3,"names":["React","connect","compose","withRouter","Tableau","config","qs","getDevice","width","breakpoints","blocks","blocksConfig","tableau_block","device","Object","keys","forEach","breakpoint","View","props","error","setError","useState","loaded","setLoaded","mounted","setMounted","extraFilters","setExtraFilters","data","query","screen","breakpointUrls","urlParameters","title","description","autoScale","version","settings","tableauVersion","page","Infinity","breakpointUrl","filter","url","useEffect","newExtraFilters","element","field","urlParam","JSON","stringify","mode","state","parse","router","location","search","replace","discodata_query"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-tableau/src/TableauBlock/View.jsx"],"sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { withRouter } from 'react-router';\nimport Tableau from '@eeacms/volto-tableau/Tableau/View';\nimport config from '@plone/volto/registry';\nimport qs from 'querystring';\nimport '@eeacms/volto-tableau/less/tableau.less';\n\nconst getDevice = (config, width) => {\n  const breakpoints = config.blocks.blocksConfig.tableau_block.breakpoints;\n  let device = 'default';\n  Object.keys(breakpoints).forEach((breakpoint) => {\n    if (\n      width <= breakpoints[breakpoint][0] &&\n      width >= breakpoints[breakpoint][1]\n    ) {\n      device = breakpoint;\n    }\n  });\n  return device;\n};\n\nconst View = (props) => {\n  const [error, setError] = React.useState(null);\n  const [loaded, setLoaded] = React.useState(null);\n  const [mounted, setMounted] = React.useState(false);\n  const [extraFilters, setExtraFilters] = React.useState({});\n  const { data = {}, query = {}, screen = {} } = props;\n  const {\n    breakpointUrls = [],\n    urlParameters = [],\n    title = null,\n    description = null,\n    autoScale = false,\n  } = data;\n  const version =\n    props.data.version || config.settings.tableauVersion || '2.8.0';\n  const device = getDevice(config, screen.page?.width || Infinity);\n  const breakpointUrl = breakpointUrls.filter(\n    (breakpoint) => breakpoint.device === device,\n  )[0]?.url;\n  const url = breakpointUrl || data.url;\n\n  React.useEffect(() => {\n    setMounted(true);\n    /* eslint-disable-next-line */\n  }, []);\n\n  React.useEffect(() => {\n    const newExtraFilters = { ...extraFilters };\n    urlParameters.forEach((element) => {\n      if (element.field && typeof query[element.urlParam] !== 'undefined') {\n        newExtraFilters[element.field] = query[element.urlParam];\n      } else if (newExtraFilters[element.field]) {\n        delete newExtraFilters[element.field];\n      }\n    });\n    setExtraFilters(newExtraFilters);\n    /* eslint-disable-next-line */\n  }, [JSON.stringify(query), JSON.stringify(urlParameters)]);\n\n  return mounted ? (\n    <div className=\"tableau-block\">\n      {props.mode === 'edit' ? (\n        <div className=\"tableau-info\">\n          <h3 className=\"tableau-version\">== Tableau {version} ==</h3>\n          {!props.data.url ? <p className=\"tableau-error\">URL required</p> : ''}\n          {error ? <p className=\"tableau-error\">{error}</p> : ''}\n        </div>\n      ) : (\n        ''\n      )}\n      {loaded && title ? <h3 className=\"tableau-title\">{title}</h3> : ''}\n      {loaded && description ? (\n        <p className=\"tableau-description\">{description}</p>\n      ) : (\n        ''\n      )}\n      <Tableau\n        {...props}\n        canUpdateUrl={!breakpointUrl}\n        extraFilters={extraFilters}\n        extraOptions={{ device: autoScale ? 'desktop' : device }}\n        error={error}\n        loaded={loaded}\n        setError={setError}\n        setLoaded={setLoaded}\n        version={version}\n        url={url}\n      />\n    </div>\n  ) : (\n    ''\n  );\n};\n\nexport default compose(\n  connect((state, props) => ({\n    query: {\n      ...(qs.parse(state.router.location?.search?.replace('?', '')) || {}),\n      ...(state.discodata_query?.search || {}),\n    },\n    screen: state.screen,\n  })),\n)(withRouter(View));\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}