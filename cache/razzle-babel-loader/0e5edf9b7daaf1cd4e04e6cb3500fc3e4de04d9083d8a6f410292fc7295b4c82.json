{"ast":null,"code":"import _isFunction from \"lodash/isFunction\";\nimport _isEqual from \"lodash/isEqual\";\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/node_modules/@plone/volto/src/components/manage/Blocks/Search/SearchBlockView.jsx\";\nvar __jsx = React.createElement;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nimport React from 'react';\nimport ListingBody from '@plone/volto/components/manage/Blocks/Listing/ListingBody';\nimport { withBlockExtensions } from '@plone/volto/helpers';\nimport config from '@plone/volto/registry';\nimport { withSearch, withQueryString } from './hocs';\nimport { compose } from 'redux';\nimport { useSelector } from 'react-redux';\nconst getListingBodyVariation = data => {\n  const {\n    variations\n  } = config.blocks.blocksConfig.listing;\n  let variation = data.listingBodyTemplate ? variations.find(({\n    id\n  }) => id === data.listingBodyTemplate) : variations.find(({\n    isDefault\n  }) => isDefault);\n  if (!variation) variation = variations[0];\n  return variation;\n};\nconst isfunc = obj => _isFunction(obj) || typeof obj === 'function';\nconst _filtered = obj => Object.assign({}, ...Object.keys(obj).map(k => {\n  const reject = k !== 'properties' && !isfunc(obj[k]);\n  return reject ? {\n    [k]: obj[k]\n  } : {};\n}));\nconst blockPropsAreChanged = (prevProps, nextProps) => {\n  const prev = _filtered(prevProps);\n  const next = _filtered(nextProps);\n  return _isEqual(prev, next);\n};\nconst applyDefaults = (data, root) => {\n  var _data$query;\n  const defaultQuery = [{\n    i: 'path',\n    o: 'plone.app.querystring.operation.string.absolutePath',\n    v: root || '/'\n  }];\n  return _objectSpread(_objectSpread({}, data), {}, {\n    sort_on: (data === null || data === void 0 ? void 0 : data.sort_on) || 'effective',\n    sort_order: (data === null || data === void 0 ? void 0 : data.sort_order) || 'descending',\n    query: data !== null && data !== void 0 && (_data$query = data.query) !== null && _data$query !== void 0 && _data$query.length ? data.query : defaultQuery\n  });\n};\nconst SearchBlockView = props => {\n  const {\n    data,\n    searchData,\n    mode = 'view',\n    variation\n  } = props;\n  const Layout = variation.view;\n  const [selectedView, setSelectedView] = React.useState(getListingBodyVariation(data).id);\n  const root = useSelector(state => state.breadcrumbs.root);\n  const listingBodyData = applyDefaults(searchData, root);\n  const {\n    variations\n  } = config.blocks.blocksConfig.listing;\n  const listingBodyVariation = variations.find(({\n    id\n  }) => id === selectedView);\n  return __jsx(\"div\", {\n    className: \"block search\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 5\n    }\n  }, __jsx(Layout, _extends({}, props, {\n    isEditMode: mode === 'edit',\n    selectedView: selectedView,\n    setSelectedView: setSelectedView,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }\n  }), __jsx(ListingBody, {\n    variation: _objectSpread(_objectSpread({}, data), listingBodyVariation),\n    data: listingBodyData,\n    path: props.path,\n    isEditMode: mode === 'edit',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 9\n    }\n  })));\n};\nexport const SearchBlockViewComponent = compose(withBlockExtensions, Component => /*#__PURE__*/React.memo(Component, blockPropsAreChanged))(SearchBlockView);\nexport default compose(withQueryString, withSearch())(SearchBlockViewComponent);","map":{"version":3,"names":["React","ListingBody","withBlockExtensions","config","withSearch","withQueryString","compose","useSelector","getListingBodyVariation","data","variations","blocks","blocksConfig","listing","variation","listingBodyTemplate","find","id","isDefault","isfunc","obj","_filtered","Object","assign","keys","map","k","reject","blockPropsAreChanged","prevProps","nextProps","prev","next","applyDefaults","root","defaultQuery","i","o","v","sort_on","sort_order","query","length","SearchBlockView","props","searchData","mode","Layout","view","selectedView","setSelectedView","useState","state","breadcrumbs","listingBodyData","listingBodyVariation","path","SearchBlockViewComponent","Component","memo"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@plone/volto/src/components/manage/Blocks/Search/SearchBlockView.jsx"],"sourcesContent":["import React from 'react';\n\nimport ListingBody from '@plone/volto/components/manage/Blocks/Listing/ListingBody';\nimport { withBlockExtensions } from '@plone/volto/helpers';\n\nimport config from '@plone/volto/registry';\n\nimport { withSearch, withQueryString } from './hocs';\nimport { compose } from 'redux';\nimport { useSelector } from 'react-redux';\nimport { isEqual, isFunction } from 'lodash';\n\nconst getListingBodyVariation = (data) => {\n  const { variations } = config.blocks.blocksConfig.listing;\n\n  let variation = data.listingBodyTemplate\n    ? variations.find(({ id }) => id === data.listingBodyTemplate)\n    : variations.find(({ isDefault }) => isDefault);\n\n  if (!variation) variation = variations[0];\n\n  return variation;\n};\n\nconst isfunc = (obj) => isFunction(obj) || typeof obj === 'function';\n\nconst _filtered = (obj) =>\n  Object.assign(\n    {},\n    ...Object.keys(obj).map((k) => {\n      const reject = k !== 'properties' && !isfunc(obj[k]);\n      return reject ? { [k]: obj[k] } : {};\n    }),\n  );\n\nconst blockPropsAreChanged = (prevProps, nextProps) => {\n  const prev = _filtered(prevProps);\n  const next = _filtered(nextProps);\n\n  return isEqual(prev, next);\n};\n\nconst applyDefaults = (data, root) => {\n  const defaultQuery = [\n    {\n      i: 'path',\n      o: 'plone.app.querystring.operation.string.absolutePath',\n      v: root || '/',\n    },\n  ];\n  return {\n    ...data,\n    sort_on: data?.sort_on || 'effective',\n    sort_order: data?.sort_order || 'descending',\n    query: data?.query?.length ? data.query : defaultQuery,\n  };\n};\n\nconst SearchBlockView = (props) => {\n  const { data, searchData, mode = 'view', variation } = props;\n\n  const Layout = variation.view;\n\n  const [selectedView, setSelectedView] = React.useState(\n    getListingBodyVariation(data).id,\n  );\n  const root = useSelector((state) => state.breadcrumbs.root);\n  const listingBodyData = applyDefaults(searchData, root);\n\n  const { variations } = config.blocks.blocksConfig.listing;\n  const listingBodyVariation = variations.find(({ id }) => id === selectedView);\n\n  return (\n    <div className=\"block search\">\n      <Layout\n        {...props}\n        isEditMode={mode === 'edit'}\n        selectedView={selectedView}\n        setSelectedView={setSelectedView}\n      >\n        <ListingBody\n          variation={{ ...data, ...listingBodyVariation }}\n          data={listingBodyData}\n          path={props.path}\n          isEditMode={mode === 'edit'}\n        />\n      </Layout>\n    </div>\n  );\n};\n\nexport const SearchBlockViewComponent = compose(\n  withBlockExtensions,\n  (Component) => React.memo(Component, blockPropsAreChanged),\n)(SearchBlockView);\n\nexport default compose(withQueryString, withSearch())(SearchBlockViewComponent);\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}