{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nimport { v4 as uuid } from 'uuid';\nimport { getBlocksFieldname, getBlocksLayoutFieldname, getBlocks } from '@plone/volto/helpers';\nimport config from '@plone/volto/registry';\nconst columnConfig = {\n  cloneData(blockData) {\n    // console.log('column', blockData);\n    return cloneFormData(blockData);\n  }\n};\nfunction cloneFormData(formData) {\n  const formBlocks = getBlocks(formData);\n  const cloneWithIds = formBlocks.filter(([id, blockData]) => {\n    return blockData.blocks ? true : !!blockData['@type']; // support \"columns\"\n  }).map(([id, blockData]) => {\n    const blockConfig = config.blocks.blocksConfig[blockData['@type']] || columnConfig;\n    return blockConfig.cloneData ? blockConfig.cloneData(blockData) : [uuid(), blockData];\n  }).filter(info => !!info); // some blocks may refuse to be copied\n\n  const blocksFieldname = getBlocksFieldname(formData);\n  const blocksLayoutFieldname = getBlocksLayoutFieldname(formData);\n  const newBlockData = {\n    [blocksFieldname]: _objectSpread(_objectSpread({}, formData[blocksFieldname]), Object.assign({}, ...cloneWithIds.map(([id, data]) => ({\n      [id]: data\n    })))),\n    [blocksLayoutFieldname]: _objectSpread(_objectSpread({}, formData[blocksLayoutFieldname]), {}, {\n      items: [...cloneWithIds.map(([id]) => id)]\n    })\n  };\n  return [uuid(), newBlockData];\n}\nexport function cloneColumnsBlockData(blockData) {\n  const columnsData = blockData.data;\n  const cloneWithIds = cloneFormData(columnsData);\n  const [id, newBlockData] = cloneWithIds;\n  return [id, _objectSpread(_objectSpread({}, blockData), {}, {\n    data: newBlockData\n  })];\n}","map":{"version":3,"names":["v4","uuid","getBlocksFieldname","getBlocksLayoutFieldname","getBlocks","config","columnConfig","cloneData","blockData","cloneFormData","formData","formBlocks","cloneWithIds","filter","id","blocks","map","blockConfig","blocksConfig","info","blocksFieldname","blocksLayoutFieldname","newBlockData","Object","assign","data","items","cloneColumnsBlockData","columnsData"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-columns-block/src/utils.js"],"sourcesContent":["import { v4 as uuid } from 'uuid';\nimport {\n  getBlocksFieldname,\n  getBlocksLayoutFieldname,\n  getBlocks,\n} from '@plone/volto/helpers';\nimport config from '@plone/volto/registry';\n\nconst columnConfig = {\n  cloneData(blockData) {\n    // console.log('column', blockData);\n    return cloneFormData(blockData);\n  },\n};\n\nfunction cloneFormData(formData) {\n  const formBlocks = getBlocks(formData);\n\n  const cloneWithIds = formBlocks\n    .filter(([id, blockData]) => {\n      return blockData.blocks ? true : !!blockData['@type']; // support \"columns\"\n    })\n    .map(([id, blockData]) => {\n      const blockConfig =\n        config.blocks.blocksConfig[blockData['@type']] || columnConfig;\n      return blockConfig.cloneData\n        ? blockConfig.cloneData(blockData)\n        : [uuid(), blockData];\n    })\n    .filter((info) => !!info); // some blocks may refuse to be copied\n\n  const blocksFieldname = getBlocksFieldname(formData);\n  const blocksLayoutFieldname = getBlocksLayoutFieldname(formData);\n\n  const newBlockData = {\n    [blocksFieldname]: {\n      ...formData[blocksFieldname],\n      ...Object.assign(\n        {},\n        ...cloneWithIds.map(([id, data]) => ({ [id]: data })),\n      ),\n    },\n    [blocksLayoutFieldname]: {\n      ...formData[blocksLayoutFieldname],\n      items: [...cloneWithIds.map(([id]) => id)],\n    },\n  };\n  return [uuid(), newBlockData];\n}\n\nexport function cloneColumnsBlockData(blockData) {\n  const columnsData = blockData.data;\n  const cloneWithIds = cloneFormData(columnsData);\n\n  const [id, newBlockData] = cloneWithIds;\n  return [\n    id,\n    {\n      ...blockData,\n      data: newBlockData,\n    },\n  ];\n}\n"],"mappings":";;;AAAA,SAASA,EAAE,IAAIC,IAAI,QAAQ,MAAM;AACjC,SACEC,kBAAkB,EAClBC,wBAAwB,EACxBC,SAAS,QACJ,sBAAsB;AAC7B,OAAOC,MAAM,MAAM,uBAAuB;AAE1C,MAAMC,YAAY,GAAG;EACnBC,SAAS,CAACC,SAAS,EAAE;IACnB;IACA,OAAOC,aAAa,CAACD,SAAS,CAAC;EACjC;AACF,CAAC;AAED,SAASC,aAAa,CAACC,QAAQ,EAAE;EAC/B,MAAMC,UAAU,GAAGP,SAAS,CAACM,QAAQ,CAAC;EAEtC,MAAME,YAAY,GAAGD,UAAU,CAC5BE,MAAM,CAAC,CAAC,CAACC,EAAE,EAAEN,SAAS,CAAC,KAAK;IAC3B,OAAOA,SAAS,CAACO,MAAM,GAAG,IAAI,GAAG,CAAC,CAACP,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;EACzD,CAAC,CAAC,CACDQ,GAAG,CAAC,CAAC,CAACF,EAAE,EAAEN,SAAS,CAAC,KAAK;IACxB,MAAMS,WAAW,GACfZ,MAAM,CAACU,MAAM,CAACG,YAAY,CAACV,SAAS,CAAC,OAAO,CAAC,CAAC,IAAIF,YAAY;IAChE,OAAOW,WAAW,CAACV,SAAS,GACxBU,WAAW,CAACV,SAAS,CAACC,SAAS,CAAC,GAChC,CAACP,IAAI,EAAE,EAAEO,SAAS,CAAC;EACzB,CAAC,CAAC,CACDK,MAAM,CAAEM,IAAI,IAAK,CAAC,CAACA,IAAI,CAAC,CAAC,CAAC;;EAE7B,MAAMC,eAAe,GAAGlB,kBAAkB,CAACQ,QAAQ,CAAC;EACpD,MAAMW,qBAAqB,GAAGlB,wBAAwB,CAACO,QAAQ,CAAC;EAEhE,MAAMY,YAAY,GAAG;IACnB,CAACF,eAAe,mCACXV,QAAQ,CAACU,eAAe,CAAC,GACzBG,MAAM,CAACC,MAAM,CACd,CAAC,CAAC,EACF,GAAGZ,YAAY,CAACI,GAAG,CAAC,CAAC,CAACF,EAAE,EAAEW,IAAI,CAAC,MAAM;MAAE,CAACX,EAAE,GAAGW;IAAK,CAAC,CAAC,CAAC,CACtD,CACF;IACD,CAACJ,qBAAqB,mCACjBX,QAAQ,CAACW,qBAAqB,CAAC;MAClCK,KAAK,EAAE,CAAC,GAAGd,YAAY,CAACI,GAAG,CAAC,CAAC,CAACF,EAAE,CAAC,KAAKA,EAAE,CAAC;IAAC;EAE9C,CAAC;EACD,OAAO,CAACb,IAAI,EAAE,EAAEqB,YAAY,CAAC;AAC/B;AAEA,OAAO,SAASK,qBAAqB,CAACnB,SAAS,EAAE;EAC/C,MAAMoB,WAAW,GAAGpB,SAAS,CAACiB,IAAI;EAClC,MAAMb,YAAY,GAAGH,aAAa,CAACmB,WAAW,CAAC;EAE/C,MAAM,CAACd,EAAE,EAAEQ,YAAY,CAAC,GAAGV,YAAY;EACvC,OAAO,CACLE,EAAE,kCAEGN,SAAS;IACZiB,IAAI,EAAEH;EAAY,GAErB;AACH"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}