{"ast":null,"code":"var _jsxFileName = \"/home/tooler/code/work/forests-frontend/node_modules/@plone/volto/src/components/manage/Blocks/Listing/withQuerystringResults.jsx\";\nvar __jsx = React.createElement;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nimport React from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport hoistNonReactStatics from 'hoist-non-react-statics';\nimport useDeepCompareEffect from 'use-deep-compare-effect';\nimport { getContent, getQueryStringResults } from '@plone/volto/actions';\nimport { usePagination, getBaseUrl } from '@plone/volto/helpers';\nimport config from '@plone/volto/registry';\nfunction getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || 'Component';\n}\nexport default function withQuerystringResults(WrappedComponent) {\n  function WithQuerystringResults(props) {\n    var _querystring$query, _querystringResults$b, _querystring$query2, _querystringResults$b2, _querystringResults$b3, _content$batching, _querystringResults$b4, _content$batching2, _querystringResults$b5, _querystringResults$b6;\n    const {\n      data = {},\n      properties: content,\n      path,\n      variation\n    } = props;\n    const {\n      settings\n    } = config;\n    const querystring = data.querystring || data; // For backwards compat with data saved before Blocks schema. Note, this is also how the Search block passes data to ListingBody\n\n    const {\n      block\n    } = data;\n    const {\n      b_size = settings.defaultPageSize\n    } = querystring; // batchsize\n\n    // save the path so it won't trigger dispatch on eager router location change\n    const [initialPath] = React.useState(getBaseUrl(path));\n    const copyFields = ['limit', 'query', 'sort_on', 'sort_order', 'depth'];\n    const adaptedQuery = Object.assign(variation !== null && variation !== void 0 && variation.fullobjects ? {\n      fullobjects: 1\n    } : {\n      metadata_fields: '_all'\n    }, {\n      b_size: b_size\n    }, ...copyFields.map(name => Object.keys(querystring).includes(name) ? {\n      [name]: querystring[name]\n    } : {}));\n    const {\n      currentPage,\n      setCurrentPage\n    } = usePagination(querystring, 1);\n    const querystringResults = useSelector(state => state.querystringsearch.subrequests);\n    const dispatch = useDispatch();\n    const folderItems = content !== null && content !== void 0 && content.is_folderish ? content.items : [];\n    const hasQuery = (querystring === null || querystring === void 0 ? void 0 : (_querystring$query = querystring.query) === null || _querystring$query === void 0 ? void 0 : _querystring$query.length) > 0;\n    const hasLoaded = hasQuery ? !(querystringResults !== null && querystringResults !== void 0 && (_querystringResults$b = querystringResults[block]) !== null && _querystringResults$b !== void 0 && _querystringResults$b.loading) : true;\n    const listingItems = (querystring === null || querystring === void 0 ? void 0 : (_querystring$query2 = querystring.query) === null || _querystring$query2 === void 0 ? void 0 : _querystring$query2.length) > 0 && querystringResults !== null && querystringResults !== void 0 && querystringResults[block] ? (querystringResults === null || querystringResults === void 0 ? void 0 : (_querystringResults$b2 = querystringResults[block]) === null || _querystringResults$b2 === void 0 ? void 0 : _querystringResults$b2.items) || [] : folderItems;\n    const showAsFolderListing = !hasQuery && (content === null || content === void 0 ? void 0 : content.items_total) > b_size;\n    const showAsQueryListing = hasQuery && (querystringResults === null || querystringResults === void 0 ? void 0 : (_querystringResults$b3 = querystringResults[block]) === null || _querystringResults$b3 === void 0 ? void 0 : _querystringResults$b3.total) > b_size;\n    const totalPages = showAsFolderListing ? Math.ceil(content.items_total / b_size) : showAsQueryListing ? Math.ceil(querystringResults[block].total / b_size) : 0;\n    const prevBatch = showAsFolderListing ? (_content$batching = content.batching) === null || _content$batching === void 0 ? void 0 : _content$batching.prev : showAsQueryListing ? (_querystringResults$b4 = querystringResults[block].batching) === null || _querystringResults$b4 === void 0 ? void 0 : _querystringResults$b4.prev : null;\n    const nextBatch = showAsFolderListing ? (_content$batching2 = content.batching) === null || _content$batching2 === void 0 ? void 0 : _content$batching2.next : showAsQueryListing ? (_querystringResults$b5 = querystringResults[block].batching) === null || _querystringResults$b5 === void 0 ? void 0 : _querystringResults$b5.next : null;\n    const isImageGallery = !data.variation && data.template === 'imageGallery' || data.variation === 'imageGallery';\n    useDeepCompareEffect(() => {\n      if (hasQuery) {\n        dispatch(getQueryStringResults(initialPath, adaptedQuery, block, currentPage));\n      } else if (isImageGallery && !hasQuery) {\n        // when used as image gallery, it doesn't need a query to list children\n        dispatch(getQueryStringResults(initialPath, _objectSpread(_objectSpread({}, adaptedQuery), {}, {\n          b_size: 10000000000,\n          query: [{\n            i: 'path',\n            o: 'plone.app.querystring.operation.string.relativePath',\n            v: ''\n          }]\n        }), block));\n      } else {\n        dispatch(getContent(initialPath, null, null, currentPage));\n      }\n    }, [block, isImageGallery, adaptedQuery, hasQuery, initialPath, dispatch, currentPage]);\n    return __jsx(WrappedComponent, _extends({}, props, {\n      onPaginationChange: (e, {\n        activePage\n      }) => setCurrentPage(activePage),\n      total: querystringResults === null || querystringResults === void 0 ? void 0 : (_querystringResults$b6 = querystringResults[block]) === null || _querystringResults$b6 === void 0 ? void 0 : _querystringResults$b6.total,\n      batch_size: b_size,\n      currentPage: currentPage,\n      totalPages: totalPages,\n      prevBatch: prevBatch,\n      nextBatch: nextBatch,\n      listingItems: listingItems,\n      hasLoaded: hasLoaded,\n      isFolderContentsListing: showAsFolderListing,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 7\n      }\n    }));\n  }\n  WithQuerystringResults.displayName = `WithQuerystringResults(${getDisplayName(WrappedComponent)})`;\n  return hoistNonReactStatics(WithQuerystringResults, WrappedComponent);\n}","map":{"version":3,"names":["React","useDispatch","useSelector","hoistNonReactStatics","useDeepCompareEffect","getContent","getQueryStringResults","usePagination","getBaseUrl","config","getDisplayName","WrappedComponent","displayName","name","withQuerystringResults","WithQuerystringResults","props","data","properties","content","path","variation","settings","querystring","block","b_size","defaultPageSize","initialPath","useState","copyFields","adaptedQuery","Object","assign","fullobjects","metadata_fields","map","keys","includes","currentPage","setCurrentPage","querystringResults","state","querystringsearch","subrequests","dispatch","folderItems","is_folderish","items","hasQuery","query","length","hasLoaded","loading","listingItems","showAsFolderListing","items_total","showAsQueryListing","total","totalPages","Math","ceil","prevBatch","batching","prev","nextBatch","next","isImageGallery","template","i","o","v","e","activePage"],"sources":["/home/tooler/code/work/forests-frontend/node_modules/@plone/volto/src/components/manage/Blocks/Listing/withQuerystringResults.jsx"],"sourcesContent":["import React from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport hoistNonReactStatics from 'hoist-non-react-statics';\nimport useDeepCompareEffect from 'use-deep-compare-effect';\n\nimport { getContent, getQueryStringResults } from '@plone/volto/actions';\nimport { usePagination, getBaseUrl } from '@plone/volto/helpers';\n\nimport config from '@plone/volto/registry';\n\nfunction getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || 'Component';\n}\n\nexport default function withQuerystringResults(WrappedComponent) {\n  function WithQuerystringResults(props) {\n    const { data = {}, properties: content, path, variation } = props;\n    const { settings } = config;\n    const querystring = data.querystring || data; // For backwards compat with data saved before Blocks schema. Note, this is also how the Search block passes data to ListingBody\n\n    const { block } = data;\n    const { b_size = settings.defaultPageSize } = querystring; // batchsize\n\n    // save the path so it won't trigger dispatch on eager router location change\n    const [initialPath] = React.useState(getBaseUrl(path));\n\n    const copyFields = ['limit', 'query', 'sort_on', 'sort_order', 'depth'];\n\n    const adaptedQuery = Object.assign(\n      variation?.fullobjects ? { fullobjects: 1 } : { metadata_fields: '_all' },\n      {\n        b_size: b_size,\n      },\n      ...copyFields.map((name) =>\n        Object.keys(querystring).includes(name)\n          ? { [name]: querystring[name] }\n          : {},\n      ),\n    );\n    const { currentPage, setCurrentPage } = usePagination(querystring, 1);\n    const querystringResults = useSelector(\n      (state) => state.querystringsearch.subrequests,\n    );\n    const dispatch = useDispatch();\n\n    const folderItems = content?.is_folderish ? content.items : [];\n    const hasQuery = querystring?.query?.length > 0;\n    const hasLoaded = hasQuery ? !querystringResults?.[block]?.loading : true;\n\n    const listingItems =\n      querystring?.query?.length > 0 && querystringResults?.[block]\n        ? querystringResults?.[block]?.items || []\n        : folderItems;\n\n    const showAsFolderListing = !hasQuery && content?.items_total > b_size;\n    const showAsQueryListing =\n      hasQuery && querystringResults?.[block]?.total > b_size;\n\n    const totalPages = showAsFolderListing\n      ? Math.ceil(content.items_total / b_size)\n      : showAsQueryListing\n      ? Math.ceil(querystringResults[block].total / b_size)\n      : 0;\n\n    const prevBatch = showAsFolderListing\n      ? content.batching?.prev\n      : showAsQueryListing\n      ? querystringResults[block].batching?.prev\n      : null;\n    const nextBatch = showAsFolderListing\n      ? content.batching?.next\n      : showAsQueryListing\n      ? querystringResults[block].batching?.next\n      : null;\n\n    const isImageGallery =\n      (!data.variation && data.template === 'imageGallery') ||\n      data.variation === 'imageGallery';\n\n    useDeepCompareEffect(() => {\n      if (hasQuery) {\n        dispatch(\n          getQueryStringResults(initialPath, adaptedQuery, block, currentPage),\n        );\n      } else if (isImageGallery && !hasQuery) {\n        // when used as image gallery, it doesn't need a query to list children\n        dispatch(\n          getQueryStringResults(\n            initialPath,\n            {\n              ...adaptedQuery,\n              b_size: 10000000000,\n              query: [\n                {\n                  i: 'path',\n                  o: 'plone.app.querystring.operation.string.relativePath',\n                  v: '',\n                },\n              ],\n            },\n            block,\n          ),\n        );\n      } else {\n        dispatch(getContent(initialPath, null, null, currentPage));\n      }\n    }, [\n      block,\n      isImageGallery,\n      adaptedQuery,\n      hasQuery,\n      initialPath,\n      dispatch,\n      currentPage,\n    ]);\n\n    return (\n      <WrappedComponent\n        {...props}\n        onPaginationChange={(e, { activePage }) => setCurrentPage(activePage)}\n        total={querystringResults?.[block]?.total}\n        batch_size={b_size}\n        currentPage={currentPage}\n        totalPages={totalPages}\n        prevBatch={prevBatch}\n        nextBatch={nextBatch}\n        listingItems={listingItems}\n        hasLoaded={hasLoaded}\n        isFolderContentsListing={showAsFolderListing}\n      />\n    );\n  }\n\n  WithQuerystringResults.displayName = `WithQuerystringResults(${getDisplayName(\n    WrappedComponent,\n  )})`;\n\n  return hoistNonReactStatics(WithQuerystringResults, WrappedComponent);\n}\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}