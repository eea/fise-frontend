{"ast":null,"code":"import _extends from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/extends.js\";\nimport _objectSpread from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _slicedToArray from \"/home/tooler/code/work/forests-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nvar _jsxFileName = \"/home/tooler/code/work/forests-frontend/src/develop/volto-tableau/src/TableauBlock/View.jsx\",\n  _this = this,\n  _s = $RefreshSig$();\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { withRouter } from 'react-router';\nimport Tableau from '@eeacms/volto-tableau/Tableau/View';\nimport config from '@plone/volto/registry';\nimport qs from 'querystring';\nimport '@eeacms/volto-tableau/less/tableau.less';\nvar getDevice = function getDevice(config, width) {\n  var breakpoints = config.blocks.blocksConfig.tableau_block.breakpoints;\n  var device = 'default';\n  Object.keys(breakpoints).forEach(function (breakpoint) {\n    if (width <= breakpoints[breakpoint][0] && width >= breakpoints[breakpoint][1]) {\n      device = breakpoint;\n    }\n  });\n  return device;\n};\nvar View = function View(props) {\n  _s();\n  var _screen$page, _breakpointUrls$filte;\n  var _React$useState = React.useState(null),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    error = _React$useState2[0],\n    setError = _React$useState2[1];\n  var _React$useState3 = React.useState(null),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    loaded = _React$useState4[0],\n    setLoaded = _React$useState4[1];\n  var _React$useState5 = React.useState(false),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    mounted = _React$useState6[0],\n    setMounted = _React$useState6[1];\n  var _React$useState7 = React.useState({}),\n    _React$useState8 = _slicedToArray(_React$useState7, 2),\n    extraFilters = _React$useState8[0],\n    setExtraFilters = _React$useState8[1];\n  var _props$data = props.data,\n    data = _props$data === void 0 ? {} : _props$data,\n    _props$query = props.query,\n    query = _props$query === void 0 ? {} : _props$query,\n    _props$screen = props.screen,\n    screen = _props$screen === void 0 ? {} : _props$screen;\n  var _data$breakpointUrls = data.breakpointUrls,\n    breakpointUrls = _data$breakpointUrls === void 0 ? [] : _data$breakpointUrls,\n    _data$urlParameters = data.urlParameters,\n    urlParameters = _data$urlParameters === void 0 ? [] : _data$urlParameters,\n    _data$title = data.title,\n    title = _data$title === void 0 ? null : _data$title,\n    _data$description = data.description,\n    description = _data$description === void 0 ? null : _data$description,\n    _data$autoScale = data.autoScale,\n    autoScale = _data$autoScale === void 0 ? false : _data$autoScale;\n  var version = props.data.version || config.settings.tableauVersion || '2.8.0';\n  var device = getDevice(config, ((_screen$page = screen.page) === null || _screen$page === void 0 ? void 0 : _screen$page.width) || Infinity);\n  var breakpointUrl = (_breakpointUrls$filte = breakpointUrls.filter(function (breakpoint) {\n    return breakpoint.device === device;\n  })[0]) === null || _breakpointUrls$filte === void 0 ? void 0 : _breakpointUrls$filte.url;\n  var url = breakpointUrl || data.url;\n  React.useEffect(function () {\n    setMounted(true);\n    /* eslint-disable-next-line */\n  }, []);\n  React.useEffect(function () {\n    var newExtraFilters = _objectSpread({}, extraFilters);\n    urlParameters.forEach(function (element) {\n      if (element.field && typeof query[element.urlParam] !== 'undefined') {\n        newExtraFilters[element.field] = query[element.urlParam];\n      } else if (newExtraFilters[element.field]) {\n        delete newExtraFilters[element.field];\n      }\n    });\n    setExtraFilters(newExtraFilters);\n    /* eslint-disable-next-line */\n  }, [JSON.stringify(query), JSON.stringify(urlParameters)]);\n  return mounted ? __jsx(\"div\", {\n    className: \"tableau-block\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 5\n    }\n  }, props.mode === 'edit' ? __jsx(\"div\", {\n    className: \"tableau-info\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }\n  }, __jsx(\"h3\", {\n    className: \"tableau-version\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 11\n    }\n  }, \"== Tableau \", version, \" ==\"), !props.data.url ? __jsx(\"p\", {\n    className: \"tableau-error\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 30\n    }\n  }, \"URL required\") : '', error ? __jsx(\"p\", {\n    className: \"tableau-error\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 20\n    }\n  }, error) : '') : '', loaded && title ? __jsx(\"h3\", {\n    className: \"tableau-title\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 26\n    }\n  }, title) : '', loaded && description ? __jsx(\"p\", {\n    className: \"tableau-description\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }\n  }, description) : '', __jsx(Tableau, _extends({}, props, {\n    canUpdateUrl: !breakpointUrl,\n    extraFilters: extraFilters,\n    extraOptions: {\n      device: autoScale ? 'desktop' : device\n    },\n    error: error,\n    loaded: loaded,\n    setError: setError,\n    setLoaded: setLoaded,\n    version: version,\n    url: url,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }\n  }))) : '';\n};\n_s(View, \"NnhyXjNmXSe7JGdlFDQ6OzAf1is=\");\n_c = View;\nexport default compose(connect(function (state, props) {\n  var _state$router$locatio, _state$router$locatio2, _state$discodata_quer;\n  return {\n    query: _objectSpread(_objectSpread({}, qs.parse((_state$router$locatio = state.router.location) === null || _state$router$locatio === void 0 ? void 0 : (_state$router$locatio2 = _state$router$locatio.search) === null || _state$router$locatio2 === void 0 ? void 0 : _state$router$locatio2.replace('?', '')) || {}), ((_state$discodata_quer = state.discodata_query) === null || _state$discodata_quer === void 0 ? void 0 : _state$discodata_quer.search) || {}),\n    screen: state.screen\n  };\n}))(withRouter(View));\nvar _c;\n$RefreshReg$(_c, \"View\");","map":{"version":3,"names":["React","connect","compose","withRouter","Tableau","config","qs","getDevice","width","breakpoints","blocks","blocksConfig","tableau_block","device","Object","keys","forEach","breakpoint","View","props","useState","error","setError","loaded","setLoaded","mounted","setMounted","extraFilters","setExtraFilters","data","query","screen","breakpointUrls","urlParameters","title","description","autoScale","version","settings","tableauVersion","page","Infinity","breakpointUrl","filter","url","useEffect","newExtraFilters","element","field","urlParam","JSON","stringify","mode","state","parse","router","location","search","replace","discodata_query"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-tableau/src/TableauBlock/View.jsx"],"sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { withRouter } from 'react-router';\nimport Tableau from '@eeacms/volto-tableau/Tableau/View';\nimport config from '@plone/volto/registry';\nimport qs from 'querystring';\nimport '@eeacms/volto-tableau/less/tableau.less';\n\nconst getDevice = (config, width) => {\n  const breakpoints = config.blocks.blocksConfig.tableau_block.breakpoints;\n  let device = 'default';\n  Object.keys(breakpoints).forEach((breakpoint) => {\n    if (\n      width <= breakpoints[breakpoint][0] &&\n      width >= breakpoints[breakpoint][1]\n    ) {\n      device = breakpoint;\n    }\n  });\n  return device;\n};\n\nconst View = (props) => {\n  const [error, setError] = React.useState(null);\n  const [loaded, setLoaded] = React.useState(null);\n  const [mounted, setMounted] = React.useState(false);\n  const [extraFilters, setExtraFilters] = React.useState({});\n  const { data = {}, query = {}, screen = {} } = props;\n  const {\n    breakpointUrls = [],\n    urlParameters = [],\n    title = null,\n    description = null,\n    autoScale = false,\n  } = data;\n  const version =\n    props.data.version || config.settings.tableauVersion || '2.8.0';\n  const device = getDevice(config, screen.page?.width || Infinity);\n  const breakpointUrl = breakpointUrls.filter(\n    (breakpoint) => breakpoint.device === device,\n  )[0]?.url;\n  const url = breakpointUrl || data.url;\n\n  React.useEffect(() => {\n    setMounted(true);\n    /* eslint-disable-next-line */\n  }, []);\n\n  React.useEffect(() => {\n    const newExtraFilters = { ...extraFilters };\n    urlParameters.forEach((element) => {\n      if (element.field && typeof query[element.urlParam] !== 'undefined') {\n        newExtraFilters[element.field] = query[element.urlParam];\n      } else if (newExtraFilters[element.field]) {\n        delete newExtraFilters[element.field];\n      }\n    });\n    setExtraFilters(newExtraFilters);\n    /* eslint-disable-next-line */\n  }, [JSON.stringify(query), JSON.stringify(urlParameters)]);\n\n  return mounted ? (\n    <div className=\"tableau-block\">\n      {props.mode === 'edit' ? (\n        <div className=\"tableau-info\">\n          <h3 className=\"tableau-version\">== Tableau {version} ==</h3>\n          {!props.data.url ? <p className=\"tableau-error\">URL required</p> : ''}\n          {error ? <p className=\"tableau-error\">{error}</p> : ''}\n        </div>\n      ) : (\n        ''\n      )}\n      {loaded && title ? <h3 className=\"tableau-title\">{title}</h3> : ''}\n      {loaded && description ? (\n        <p className=\"tableau-description\">{description}</p>\n      ) : (\n        ''\n      )}\n      <Tableau\n        {...props}\n        canUpdateUrl={!breakpointUrl}\n        extraFilters={extraFilters}\n        extraOptions={{ device: autoScale ? 'desktop' : device }}\n        error={error}\n        loaded={loaded}\n        setError={setError}\n        setLoaded={setLoaded}\n        version={version}\n        url={url}\n      />\n    </div>\n  ) : (\n    ''\n  );\n};\n\nexport default compose(\n  connect((state, props) => ({\n    query: {\n      ...(qs.parse(state.router.location?.search?.replace('?', '')) || {}),\n      ...(state.discodata_query?.search || {}),\n    },\n    screen: state.screen,\n  })),\n)(withRouter(View));\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}