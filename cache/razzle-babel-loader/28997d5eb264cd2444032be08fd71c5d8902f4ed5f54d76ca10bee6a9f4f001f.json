{"ast":null,"code":"import { Node } from 'slate';\nimport { isCursorAtBlockStart, isCursorAtBlockEnd, getNextVoltoBlock, getPreviousVoltoBlock, createDefaultBlock } from 'volto-slate/utils';\n\n/**\n * goUp.\n *\n * @param {}\n */\nexport function goUp({\n  editor,\n  event\n}) {\n  if (isCursorAtBlockStart(editor)) {\n    var _prev$;\n    const props = editor.getBlockProps();\n    const {\n      onFocusPreviousBlock,\n      block,\n      blockNode\n    } = props;\n\n    // const { formContext } = editor;\n    // const properties = formContext.contextData.formData;\n    const {\n      properties\n    } = editor.getBlockProps();\n    const prev = getPreviousVoltoBlock(props.index, properties);\n    if (!prev || ((_prev$ = prev[0]) === null || _prev$ === void 0 ? void 0 : _prev$['@type']) !== 'slate') return onFocusPreviousBlock(block, blockNode.current);\n    const [slateBlock, id] = prev;\n    const pseudoEditor = {\n      children: slateBlock.value || [createDefaultBlock()]\n    };\n    const match = Node.last(pseudoEditor, []);\n    if (!match) return onFocusPreviousBlock(block, blockNode.current);\n    const [node, path] = match;\n    const point = {\n      path,\n      offset: ((node === null || node === void 0 ? void 0 : node.text) || '').length\n    };\n    const selection = {\n      anchor: point,\n      focus: point\n    };\n    props.saveSlateBlockSelection(id, selection);\n    return onFocusPreviousBlock(block, blockNode.current);\n  }\n}\n\n/**\n * goDown.\n *\n * @param {}\n */\nexport function goDown({\n  editor,\n  event\n}) {\n  if (isCursorAtBlockEnd(editor)) {\n    var _next$;\n    const props = editor.getBlockProps();\n    const {\n      onFocusNextBlock,\n      block,\n      blockNode\n    } = props;\n\n    // const { formContext } = editor;\n    // const properties = formContext.contextData.formData;\n    const {\n      properties\n    } = editor.getBlockProps();\n    const next = getNextVoltoBlock(props.index, properties);\n    if (!next || ((_next$ = next[0]) === null || _next$ === void 0 ? void 0 : _next$['@type']) !== 'slate') return onFocusNextBlock(block, blockNode.current);\n    const [slateBlock, id] = next;\n    const pseudoEditor = {\n      children: slateBlock.value || [createDefaultBlock()]\n    };\n    const match = Node.first(pseudoEditor, []);\n    if (!match) return onFocusNextBlock(block, blockNode.current);\n    const path = match[1];\n    const point = {\n      path,\n      offset: 0\n    };\n    const selection = {\n      anchor: point,\n      focus: point\n    };\n    props.saveSlateBlockSelection(id, selection);\n    return onFocusNextBlock(block, blockNode.current);\n  }\n}\nexport function traverseBlocks(opts) {\n  const {\n    event\n  } = opts;\n  event.preventDefault();\n  // return event.shiftKey ? goUp(opts) : goDown(opts);\n  return true;\n}","map":{"version":3,"names":["Node","isCursorAtBlockStart","isCursorAtBlockEnd","getNextVoltoBlock","getPreviousVoltoBlock","createDefaultBlock","goUp","editor","event","props","getBlockProps","onFocusPreviousBlock","block","blockNode","properties","prev","index","current","slateBlock","id","pseudoEditor","children","value","match","last","node","path","point","offset","text","length","selection","anchor","focus","saveSlateBlockSelection","goDown","onFocusNextBlock","next","first","traverseBlocks","opts","preventDefault"],"sources":["/home/tooler/code/work/forests-frontend/src/develop/volto-slate/src/blocks/Text/keyboard/traverseBlocks.js"],"sourcesContent":["import { Node } from 'slate';\nimport {\n  isCursorAtBlockStart,\n  isCursorAtBlockEnd,\n  getNextVoltoBlock,\n  getPreviousVoltoBlock,\n  createDefaultBlock,\n} from 'volto-slate/utils';\n\n/**\n * goUp.\n *\n * @param {}\n */\nexport function goUp({ editor, event }) {\n  if (isCursorAtBlockStart(editor)) {\n    const props = editor.getBlockProps();\n    const { onFocusPreviousBlock, block, blockNode } = props;\n\n    // const { formContext } = editor;\n    // const properties = formContext.contextData.formData;\n    const { properties } = editor.getBlockProps();\n\n    const prev = getPreviousVoltoBlock(props.index, properties);\n    if (!prev || prev[0]?.['@type'] !== 'slate')\n      return onFocusPreviousBlock(block, blockNode.current);\n\n    const [slateBlock, id] = prev;\n    const pseudoEditor = {\n      children: slateBlock.value || [createDefaultBlock()],\n    };\n    const match = Node.last(pseudoEditor, []);\n    if (!match) return onFocusPreviousBlock(block, blockNode.current);\n\n    const [node, path] = match;\n    const point = { path, offset: (node?.text || '').length };\n    const selection = { anchor: point, focus: point };\n    props.saveSlateBlockSelection(id, selection);\n    return onFocusPreviousBlock(block, blockNode.current);\n  }\n}\n\n/**\n * goDown.\n *\n * @param {}\n */\nexport function goDown({ editor, event }) {\n  if (isCursorAtBlockEnd(editor)) {\n    const props = editor.getBlockProps();\n    const { onFocusNextBlock, block, blockNode } = props;\n\n    // const { formContext } = editor;\n    // const properties = formContext.contextData.formData;\n    const { properties } = editor.getBlockProps();\n\n    const next = getNextVoltoBlock(props.index, properties);\n    if (!next || next[0]?.['@type'] !== 'slate')\n      return onFocusNextBlock(block, blockNode.current);\n\n    const [slateBlock, id] = next;\n    const pseudoEditor = {\n      children: slateBlock.value || [createDefaultBlock()],\n    };\n    const match = Node.first(pseudoEditor, []);\n    if (!match) return onFocusNextBlock(block, blockNode.current);\n\n    const path = match[1];\n    const point = { path, offset: 0 };\n    const selection = { anchor: point, focus: point };\n    props.saveSlateBlockSelection(id, selection);\n    return onFocusNextBlock(block, blockNode.current);\n  }\n}\n\nexport function traverseBlocks(opts) {\n  const { event } = opts;\n  event.preventDefault();\n  // return event.shiftKey ? goUp(opts) : goDown(opts);\n  return true;\n}\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}